var fabric=fabric||{version:"2.3.2"};"undefined"!=typeof exports?exports.fabric=fabric:"function"==typeof define&&define.amd&&define([],function(){return fabric}),"undefined"!=typeof document&&"undefined"!=typeof window?(fabric.document=document,fabric.window=window):(fabric.document=require("jsdom").jsdom(decodeURIComponent("%3C!DOCTYPE%20html%3E%3Chtml%3E%3Chead%3E%3C%2Fhead%3E%3Cbody%3E%3C%2Fbody%3E%3C%2Fhtml%3E"),{features:{FetchExternalResources:["img"]}}),fabric.jsdomImplForWrapper=require("jsdom/lib/jsdom/living/generated/utils").implForWrapper,fabric.nodeCanvas=require("jsdom/lib/jsdom/utils").Canvas,fabric.window=fabric.document.defaultView,DOMParser=require("xmldom").DOMParser),fabric.isTouchSupported="ontouchstart"in fabric.window,fabric.isLikelyNode="undefined"!=typeof Buffer&&"undefined"==typeof window,fabric.DPI=96,fabric.reNum="(?:[-+]?(?:\\d+|\\d*\\.\\d+)(?:e[-+]?\\d+)?)",fabric.fontPaths={},fabric.iMatrix=[1,0,0,1,0,0],fabric.canvasModule="canvas",fabric.perfLimitSizeTotal=2097152,fabric.maxCacheSideLimit=4096,fabric.minCacheSideLimit=256,fabric.charWidthsCache={},fabric.textureSize=2048,fabric.enableGLFiltering=!0,fabric.devicePixelRatio=fabric.window.devicePixelRatio||fabric.window.webkitDevicePixelRatio||fabric.window.mozDevicePixelRatio||1,fabric.browserShadowBlurConstant=1,fabric.initFilterBackend=function(){return fabric.enableGLFiltering&&fabric.isWebglSupported&&fabric.isWebglSupported(fabric.textureSize)?(console.log("max texture size: "+fabric.maxTextureSize),new fabric.WebglFilterBackend({tileSize:fabric.textureSize})):fabric.Canvas2dFilterBackend?new fabric.Canvas2dFilterBackend:void 0};if("undefined"==typeof eventjs)var eventjs={};if(function(e){"use strict";e.modifyEventListener=!1,e.modifySelectors=!1,e.configure=function(t){isFinite(t.modifyEventListener)&&(e.modifyEventListener=t.modifyEventListener),isFinite(t.modifySelectors)&&(e.modifySelectors=t.modifySelectors),l===!1&&e.modifyEventListener&&p(),g===!1&&e.modifySelectors&&m()},e.add=function(e,t,r,o){return n(e,t,r,o,"add")},e.remove=function(e,t,r,o){return n(e,t,r,o,"remove")},e.returnFalse=function(){return!1},e.stop=function(e){e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e.cancelBubbleCount=0)},e.prevent=function(e){e&&(e.preventDefault?e.preventDefault():e.preventManipulation?e.preventManipulation():e.returnValue=!1)},e.cancel=function(t){e.stop(t),e.prevent(t)},e.blur=function(){var e=document.activeElement;if(e){var t=document.activeElement.nodeName;("INPUT"===t||"TEXTAREA"===t||"true"===e.contentEditable)&&e.blur&&e.blur()}},e.getEventSupport=function(e,t){if("string"==typeof e&&(t=e,e=window),t="on"+t,t in e)return!0;if(e.setAttribute||(e=document.createElement("div")),e.setAttribute&&e.removeAttribute){e.setAttribute(t,"");var n="function"==typeof e[t];return"undefined"!=typeof e[t]&&(e[t]=null),e.removeAttribute(t),n}};var t=function(e){if(!e||"object"!=typeof e)return e;var n=new e.constructor;for(var r in e)n[r]=e[r]&&"object"==typeof e[r]?t(e[r]):e[r];return n},n=function(i,s,v,l,p,g){if(l=l||{},"[object Object]"===String(i)){var m=i;if(i=m.target,delete m.target,!m.type||!m.listener){for(var y in m){var j=m[y];"function"!=typeof j&&(l[y]=j)}var w={};for(var h in m){var y=h.split(","),b=m[h],x={};for(var E in l)x[E]=l[E];if("function"==typeof b)var v=b;else{if("function"!=typeof b.listener)continue;var v=b.listener;for(var E in b)"function"!=typeof b[E]&&(x[E]=b[E])}for(var P=0;P<y.length;P++)w[h]=eventjs.add(i,y[P],v,x,p)}return w}s=m.type,delete m.type,v=m.listener,delete m.listener;for(var h in m)l[h]=m[h]}if(i&&s&&v){if("string"==typeof i&&"ready"===s){if(!window.eventjs_stallOnReady){var M=(new Date).getTime(),L=l.timeout,T=l.interval||1e3/60,G=window.setInterval(function(){(new Date).getTime()-M>L&&window.clearInterval(G),document.querySelector(i)&&(window.clearInterval(G),setTimeout(v,1))},T);return}s="load",i=window}if("string"==typeof i){if(i=document.querySelectorAll(i),0===i.length)return o("Missing target on listener!",arguments);1===i.length&&(i=i[0])}var D,S={};if(i.length>0&&i!==window){for(var k=0,C=i.length;C>k;k++)D=n(i[k],s,v,t(l),p),D&&(S[k]=D);return r(S)}if("string"==typeof s&&(s=s.toLowerCase(),-1!==s.indexOf(" ")?s=s.split(" "):-1!==s.indexOf(",")&&(s=s.split(","))),"string"!=typeof s){if("number"==typeof s.length)for(var X=0,Y=s.length;Y>X;X++)D=n(i,s[X],v,t(l),p),D&&(S[s[X]]=D);else for(var h in s)D="function"==typeof s[h]?n(i,h,s[h],t(l),p):n(i,h,s[h].listener,t(s[h]),p),D&&(S[h]=D);return r(S)}if(0===s.indexOf("on")&&(s=s.substr(2)),"object"!=typeof i)return o("Target is not defined!",arguments);if("function"!=typeof v)return o("Listener is not a function!",arguments);var F=l.useCapture||!1,H=d(i)+"."+d(v)+"."+(F?1:0);if(e.Gesture&&e.Gesture._gestureHandlers[s]){if(H=s+H,"remove"===p){if(!u[H])return;u[H].remove(),delete u[H]}else if("add"===p){if(u[H])return u[H].add(),u[H];if(l.useCall&&!e.modifyEventListener){var _=v;v=function(e,t){for(var n in t)e[n]=t[n];return _.call(i,e)}}l.gesture=s,l.target=i,l.listener=v,l.fromOverwrite=g,u[H]=e.proxy[s](l)}return u[H]}for(var U,O=a(s),P=0;P<O.length;P++)if(s=O[P],U=s+"."+H,"remove"===p){if(!u[U])continue;i[c](s,v,F),delete u[U]}else if("add"===p){if(u[U])return u[U];i[f](s,v,F),u[U]={id:U,type:s,target:i,listener:v,remove:function(){for(var t=0;t<O.length;t++)e.remove(i,O[t],v,l)}}}return u[U]}},r=function(e){return{remove:function(){for(var t in e)e[t].remove()},add:function(){for(var t in e)e[t].add()}}},o=function(e,t){"undefined"!=typeof console&&"undefined"!=typeof console.error&&console.error(e,t)},i={msPointer:["MSPointerDown","MSPointerMove","MSPointerUp"],touch:["touchstart","touchmove","touchend"],mouse:["mousedown","mousemove","mouseup"]},s={MSPointerDown:0,MSPointerMove:1,MSPointerUp:2,touchstart:0,touchmove:1,touchend:2,mousedown:0,mousemove:1,mouseup:2},a=(function(){e.supports={},window.navigator.msPointerEnabled&&(e.supports.msPointer=!0),e.getEventSupport("touchstart")&&(e.supports.touch=!0),e.getEventSupport("mousedown")&&(e.supports.mouse=!0)}(),function(){return function(t){var n=document.addEventListener?"":"on",r=s[t];if(isFinite(r)){var o=[];for(var a in e.supports)o.push(n+i[a][r]);return o}return[n+t]}}()),u={},v=0,d=function(e){return e===window?"#window":e===document?"#document":(e.uniqueID||(e.uniqueID="e"+v++),e.uniqueID)},f=document.addEventListener?"addEventListener":"attachEvent",c=document.removeEventListener?"removeEventListener":"detachEvent";e.createPointerEvent=function(t,n,r){var o=n.gesture,i=n.target,s=t.changedTouches||e.proxy.getCoords(t);if(s.length){var a=s[0];n.pointers=r?[]:s,n.pageX=a.pageX,n.pageY=a.pageY,n.x=n.pageX,n.y=n.pageY}var u=document.createEvent("Event");u.initEvent(o,!0,!0),u.originalEvent=t;for(var v in n)"target"!==v&&(u[v]=n[v]);var d=u.type;e.Gesture&&e.Gesture._gestureHandlers[d]&&n.oldListener.call(i,u,n,!1)};var l=!1,p=function(){if(window.HTMLElement){var t=function(t){var r=function(r){var o=r+"EventListener",i=t[o];t[o]=function(t,o,s){if(e.Gesture&&e.Gesture._gestureHandlers[t]){var u=s;"object"==typeof s?u.useCall=!0:u={useCall:!0,useCapture:s},n(this,t,o,u,r,!0)}else for(var v=a(t),d=0;d<v.length;d++)i.call(this,v[d],o,s)}};r("add"),r("remove")};navigator.userAgent.match(/Firefox/)?(t(HTMLDivElement.prototype),t(HTMLCanvasElement.prototype)):t(HTMLElement.prototype),t(document),t(window)}},g=!1,m=function(){var e=NodeList.prototype;e.removeEventListener=function(e,t,n){for(var r=0,o=this.length;o>r;r++)this[r].removeEventListener(e,t,n)},e.addEventListener=function(e,t,n){for(var r=0,o=this.length;o>r;r++)this[r].addEventListener(e,t,n)}};return e}(eventjs),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";e.pointerSetup=function(e,t){e.target=e.target||window,e.doc=e.target.ownerDocument||e.target,e.minFingers=e.minFingers||e.fingers||1,e.maxFingers=e.maxFingers||e.fingers||1/0,e.position=e.position||"relative",delete e.fingers,t=t||{},t.enabled=!0,t.gesture=e.gesture,t.target=e.target,t.env=e.env,eventjs.modifyEventListener&&e.fromOverwrite&&(e.oldListener=e.listener,e.listener=eventjs.createPointerEvent);var n=0,r=0===t.gesture.indexOf("pointer")&&eventjs.modifyEventListener?"pointer":"mouse";return e.oldListener&&(t.oldListener=e.oldListener),t.listener=e.listener,t.proxy=function(n){t.defaultListener=e.listener,e.listener=n,n(e.event,t)},t.add=function(){t.enabled!==!0&&(e.onPointerDown&&eventjs.add(e.target,r+"down",e.onPointerDown),e.onPointerMove&&eventjs.add(e.doc,r+"move",e.onPointerMove),e.onPointerUp&&eventjs.add(e.doc,r+"up",e.onPointerUp),t.enabled=!0)},t.remove=function(){t.enabled!==!1&&(e.onPointerDown&&eventjs.remove(e.target,r+"down",e.onPointerDown),e.onPointerMove&&eventjs.remove(e.doc,r+"move",e.onPointerMove),e.onPointerUp&&eventjs.remove(e.doc,r+"up",e.onPointerUp),t.reset(),t.enabled=!1)},t.pause=function(t){!e.onPointerMove||t&&!t.move||eventjs.remove(e.doc,r+"move",e.onPointerMove),!e.onPointerUp||t&&!t.up||eventjs.remove(e.doc,r+"up",e.onPointerUp),n=e.fingers,e.fingers=0},t.resume=function(t){!e.onPointerMove||t&&!t.move||eventjs.add(e.doc,r+"move",e.onPointerMove),!e.onPointerUp||t&&!t.up||eventjs.add(e.doc,r+"up",e.onPointerUp),e.fingers=n},t.reset=function(){e.tracker={},e.fingers=0},t};var t=eventjs.supports;eventjs.isMouse=!!t.mouse,eventjs.isMSPointer=!!t.touch,eventjs.isTouch=!!t.msPointer,e.pointerStart=function(t,n,r){var o=(t.type||"mousedown").toUpperCase();0===o.indexOf("MOUSE")?(eventjs.isMouse=!0,eventjs.isTouch=!1,eventjs.isMSPointer=!1):0===o.indexOf("TOUCH")?(eventjs.isMouse=!1,eventjs.isTouch=!0,eventjs.isMSPointer=!1):0===o.indexOf("MSPOINTER")&&(eventjs.isMouse=!1,eventjs.isTouch=!1,eventjs.isMSPointer=!0);var i=function(e,t){var n=r.bbox,o=a[t]={};switch(r.position){case"absolute":o.offsetX=0,o.offsetY=0;break;case"differenceFromLast":o.offsetX=e.pageX,o.offsetY=e.pageY;break;case"difference":o.offsetX=e.pageX,o.offsetY=e.pageY;break;case"move":o.offsetX=e.pageX-n.x1,o.offsetY=e.pageY-n.y1;break;default:o.offsetX=n.x1-n.scrollLeft,o.offsetY=n.y1-n.scrollTop}var i=e.pageX-o.offsetX,s=e.pageY-o.offsetY;o.rotation=0,o.scale=1,o.startTime=o.moveTime=(new Date).getTime(),o.move={x:i,y:s},o.start={x:i,y:s},r.fingers++};r.event=t,n.defaultListener&&(r.listener=n.defaultListener,delete n.defaultListener);for(var s=!r.fingers,a=r.tracker,u=t.changedTouches||e.getCoords(t),v=u.length,d=0;v>d;d++){var f=u[d],c=f.identifier||1/0;if(r.fingers){if(r.fingers>=r.maxFingers){var l=[];for(var c in r.tracker)l.push(c);return n.identifier=l.join(","),s}var p=0;for(var g in a){if(a[g].up){delete a[g],i(f,c),r.cancel=!0;break}p++}if(a[c])continue;i(f,c)}else a=r.tracker={},n.bbox=r.bbox=e.getBoundingBox(r.target),r.fingers=0,r.cancel=!1,i(f,c)}var l=[];for(var c in r.tracker)l.push(c);return n.identifier=l.join(","),s},e.pointerEnd=function(e,t,n,r){for(var o=e.touches||[],i=o.length,s={},a=0;i>a;a++){var u=o[a],v=u.identifier;s[v||1/0]=!0}for(var v in n.tracker){var d=n.tracker[v];s[v]||d.up||(r&&r({pageX:d.pageX,pageY:d.pageY,changedTouches:[{pageX:d.pageX,pageY:d.pageY,identifier:"Infinity"===v?1/0:v}]},"up"),d.up=!0,n.fingers--)}if(0!==n.fingers)return!1;var f=[];n.gestureFingers=0;for(var v in n.tracker)n.gestureFingers++,f.push(v);return t.identifier=f.join(","),!0},e.getCoords=function(t){return e.getCoords="undefined"!=typeof t.pageX?function(e){return Array({type:"mouse",x:e.pageX,y:e.pageY,pageX:e.pageX,pageY:e.pageY,identifier:e.pointerId||1/0})}:function(e){var t=document.documentElement;return e=e||window.event,Array({type:"mouse",x:e.clientX+t.scrollLeft,y:e.clientY+t.scrollTop,pageX:e.clientX+t.scrollLeft,pageY:e.clientY+t.scrollTop,identifier:1/0})},e.getCoords(t)},e.getCoord=function(t){if("ontouchstart"in window){var n=0,r=0;e.getCoord=function(e){var t=e.changedTouches;return t&&t.length?{x:n=t[0].pageX,y:r=t[0].pageY}:{x:n,y:r}}}else e.getCoord="undefined"!=typeof t.pageX&&"undefined"!=typeof t.pageY?function(e){return{x:e.pageX,y:e.pageY}}:function(e){var t=document.documentElement;return e=e||window.event,{x:e.clientX+t.scrollLeft,y:e.clientY+t.scrollTop}};return e.getCoord(t)};var n=function(e,t){var n=parseFloat(e.getPropertyValue(t),10);return isFinite(n)?n:0};return e.getBoundingBox=function(e){(e===window||e===document)&&(e=document.body);var t={},r=e.getBoundingClientRect();t.width=r.width,t.height=r.height,t.x1=r.left,t.y1=r.top,t.scaleX=r.width/e.offsetWidth||1,t.scaleY=r.height/e.offsetHeight||1,t.scrollLeft=0,t.scrollTop=0;var o=window.getComputedStyle(e),i="border-box"===o.getPropertyValue("box-sizing");if(i===!1){var s=n(o,"border-left-width"),a=n(o,"border-right-width"),u=n(o,"border-bottom-width"),v=n(o,"border-top-width");t.border=[s,a,v,u],t.x1+=s,t.y1+=v,t.width-=a+s,t.height-=u+v}t.x2=t.x1+t.width,t.y2=t.y1+t.height;for(var d=o.getPropertyValue("position"),f="fixed"===d?e:e.parentNode;null!==f&&f!==document.body&&void 0!==f.scrollTop;){var o=window.getComputedStyle(f),d=o.getPropertyValue("position");if("absolute"===d);else{if("fixed"===d){t.scrollTop-=f.parentNode.scrollTop,t.scrollLeft-=f.parentNode.scrollLeft;break}t.scrollLeft+=f.scrollLeft,t.scrollTop+=f.scrollTop}f=f.parentNode}return t.scrollBodyLeft=void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,t.scrollBodyTop=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,t.scrollLeft-=t.scrollBodyLeft,t.scrollTop-=t.scrollBodyTop,t},function(){var t,n=navigator.userAgent.toLowerCase(),r=-1!==n.indexOf("macintosh");t=r&&-1!==n.indexOf("khtml")?{91:!0,93:!0}:r&&-1!==n.indexOf("firefox")?{224:!0}:{17:!0},(e.metaTrackerReset=function(){eventjs.fnKey=e.fnKey=!1,eventjs.metaKey=e.metaKey=!1,eventjs.escKey=e.escKey=!1,eventjs.ctrlKey=e.ctrlKey=!1,eventjs.shiftKey=e.shiftKey=!1,eventjs.altKey=e.altKey=!1})(),e.metaTracker=function(n){var r="keydown"===n.type;27===n.keyCode&&(eventjs.escKey=e.escKey=r),t[n.keyCode]&&(eventjs.metaKey=e.metaKey=r),eventjs.ctrlKey=e.ctrlKey=n.ctrlKey,eventjs.shiftKey=e.shiftKey=n.shiftKey,eventjs.altKey=e.altKey=n.altKey}}(),e}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if(eventjs.MutationObserver=function(){var e=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,t=!e&&function(){var e=document.createElement("p"),t=!1,n=function(){t=!0};if(e.addEventListener)e.addEventListener("DOMAttrModified",n,!1);else{if(!e.attachEvent)return!1;e.attachEvent("onDOMAttrModified",n)}return e.setAttribute("id","target"),t}();return function(n,r){if(e){var o={subtree:!1,attributes:!0},i=new e(function(e){e.forEach(function(e){r.call(e.target,e.attributeName)})});i.observe(n,o)}else t?eventjs.add(n,"DOMAttrModified",function(e){r.call(n,e.attrName)}):"onpropertychange"in document.body&&eventjs.add(n,"propertychange",function(){r.call(n,window.event.propertyName)})}}(),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";return e.click=function(t){t.gesture=t.gesture||"click",t.maxFingers=t.maxFingers||t.fingers||1,t.onPointerDown=function(r){e.pointerStart(r,n,t)&&eventjs.add(t.target,"mouseup",t.onPointerUp)},t.onPointerUp=function(r){if(e.pointerEnd(r,n,t)){eventjs.remove(t.target,"mouseup",t.onPointerUp);var o=r.changedTouches||e.getCoords(r),i=o[0],s=t.bbox,a=e.getBoundingBox(t.target),u=i.pageY-a.scrollBodyTop,v=i.pageX-a.scrollBodyLeft;if(v>s.x1&&u>s.y1&&v<s.x2&&u<s.y2&&s.scrollTop===a.scrollTop){for(var d in t.tracker)break;var f=t.tracker[d];n.x=f.start.x,n.y=f.start.y,t.listener(r,n)}}};var n=e.pointerSetup(t);return n.state="click",eventjs.add(t.target,"mousedown",t.onPointerDown),n},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.click=e.click,e}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";return e.dbltap=e.dblclick=function(t){t.gesture=t.gesture||"dbltap",t.maxFingers=t.maxFingers||t.fingers||1;var n,r,o,i,s,a=700;t.onPointerDown=function(v){var d=v.changedTouches||e.getCoords(v);n&&!r?(s=d[0],r=(new Date).getTime()-n):(i=d[0],n=(new Date).getTime(),r=0,clearTimeout(o),o=setTimeout(function(){n=0},a)),e.pointerStart(v,u,t)&&(eventjs.add(t.target,"mousemove",t.onPointerMove).listener(v),eventjs.add(t.target,"mouseup",t.onPointerUp))},t.onPointerMove=function(a){if(n&&!r){var u=a.changedTouches||e.getCoords(a);s=u[0]}var v=t.bbox,d=s.pageX-v.x1,f=s.pageY-v.y1;d>0&&d<v.width&&f>0&&f<v.height&&Math.abs(s.pageX-i.pageX)<=25&&Math.abs(s.pageY-i.pageY)<=25||(eventjs.remove(t.target,"mousemove",t.onPointerMove),clearTimeout(o),n=r=0)},t.onPointerUp=function(i){if(e.pointerEnd(i,u,t)&&(eventjs.remove(t.target,"mousemove",t.onPointerMove),eventjs.remove(t.target,"mouseup",t.onPointerUp)),n&&r){if(a>=r){u.state=t.gesture;for(var s in t.tracker)break;var v=t.tracker[s];u.x=v.start.x,u.y=v.start.y,t.listener(i,u)}clearTimeout(o),n=r=0}};var u=e.pointerSetup(t);return u.state="dblclick",eventjs.add(t.target,"mousedown",t.onPointerDown),u},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.dbltap=e.dbltap,eventjs.Gesture._gestureHandlers.dblclick=e.dblclick,e}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";return e.dragElement=function(t,n){e.drag({event:n,target:t,position:"move",listener:function(e,n){t.style.left=n.x+"px",t.style.top=n.y+"px",eventjs.prevent(e)}})},e.drag=function(t){t.gesture="drag",t.onPointerDown=function(r){e.pointerStart(r,n,t)&&(t.monitor||(eventjs.add(t.doc,"mousemove",t.onPointerMove),eventjs.add(t.doc,"mouseup",t.onPointerUp))),t.onPointerMove(r,"down")},t.onPointerMove=function(r,o){if(!t.tracker)return t.onPointerDown(r);for(var i=(t.bbox,r.changedTouches||e.getCoords(r)),s=i.length,a=0;s>a;a++){var u=i[a],v=u.identifier||1/0,d=t.tracker[v];d&&(d.pageX=u.pageX,d.pageY=u.pageY,n.state=o||"move",n.identifier=v,n.start=d.start,n.fingers=t.fingers,"differenceFromLast"===t.position?(n.x=d.pageX-d.offsetX,n.y=d.pageY-d.offsetY,d.offsetX=d.pageX,d.offsetY=d.pageY):(n.x=d.pageX-d.offsetX,n.y=d.pageY-d.offsetY),t.listener(r,n))}},t.onPointerUp=function(r){e.pointerEnd(r,n,t,t.onPointerMove)&&(t.monitor||(eventjs.remove(t.doc,"mousemove",t.onPointerMove),eventjs.remove(t.doc,"mouseup",t.onPointerUp)))};var n=e.pointerSetup(t);return t.event?t.onPointerDown(t.event):(eventjs.add(t.target,"mousedown",t.onPointerDown),t.monitor&&(eventjs.add(t.doc,"mousemove",t.onPointerMove),eventjs.add(t.doc,"mouseup",t.onPointerUp))),n},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.drag=e.drag,e}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";var t=Math.PI/180,n=function(e,t){var n=0,r=0,o=0;for(var i in t){var s=t[i];s.up||(n+=s.move.x,r+=s.move.y,o++)}return e.x=n/=o,e.y=r/=o,e};return e.gesture=function(r){r.gesture=r.gesture||"gesture",r.minFingers=r.minFingers||r.fingers||2,r.onPointerDown=function(t){var i=r.fingers;if(e.pointerStart(t,o,r)&&(eventjs.add(r.doc,"mousemove",r.onPointerMove),eventjs.add(r.doc,"mouseup",r.onPointerUp)),r.fingers===r.minFingers&&i!==r.fingers){o.fingers=r.minFingers,o.scale=1,o.rotation=0,o.state="start";var s="";for(var a in r.tracker)s+=a;o.identifier=parseInt(s),n(o,r.tracker),r.listener(t,o)}},r.onPointerMove=function(i){for(var s=r.bbox,a=r.tracker,u=i.changedTouches||e.getCoords(i),v=u.length,d=0;v>d;d++){var f=u[d],c=f.identifier||1/0,l=a[c];l&&(l.move.x=f.pageX-s.x1,l.move.y=f.pageY-s.y1)}if(!(r.fingers<r.minFingers)){var u=[],p=0,g=0;n(o,a);for(var c in a){var f=a[c];if(!f.up){var m=f.start;if(!m.distance){var y=m.x-o.x,j=m.y-o.y;m.distance=Math.sqrt(y*y+j*j),m.angle=Math.atan2(y,j)/t}var y=f.move.x-o.x,j=f.move.y-o.y,w=Math.sqrt(y*y+j*j);p+=w/m.distance;var h=Math.atan2(y,j)/t,b=(m.angle-h+360)%360-180;f.DEG2=f.DEG1,f.DEG1=b>0?b:-b,"undefined"!=typeof f.DEG2&&(b>0?f.rotation+=f.DEG1-f.DEG2:f.rotation-=f.DEG1-f.DEG2,g+=f.rotation),u.push(f.move)}}o.touches=u,o.fingers=r.fingers,o.scale=p/r.fingers,o.rotation=g/r.fingers,o.state="change",r.listener(i,o)}},r.onPointerUp=function(t){var n=r.fingers;e.pointerEnd(t,o,r)&&(eventjs.remove(r.doc,"mousemove",r.onPointerMove),eventjs.remove(r.doc,"mouseup",r.onPointerUp)),n===r.minFingers&&r.fingers<r.minFingers&&(o.fingers=r.fingers,o.state="end",r.listener(t,o))};var o=e.pointerSetup(r);return eventjs.add(r.target,"mousedown",r.onPointerDown),o},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.gesture=e.gesture,e}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";return e.pointerdown=e.pointermove=e.pointerup=function(t){if(t.gesture=t.gesture||"pointer",!t.target.isPointerEmitter){var n=!0;t.onPointerDown=function(e){n=!1,r.gesture="pointerdown",t.listener(e,r)},t.onPointerMove=function(e){r.gesture="pointermove",t.listener(e,r,n)},t.onPointerUp=function(e){n=!0,r.gesture="pointerup",t.listener(e,r,!0)};var r=e.pointerSetup(t);return eventjs.add(t.target,"mousedown",t.onPointerDown),eventjs.add(t.target,"mousemove",t.onPointerMove),eventjs.add(t.doc,"mouseup",t.onPointerUp),t.target.isPointerEmitter=!0,r}},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.pointerdown=e.pointerdown,eventjs.Gesture._gestureHandlers.pointermove=e.pointermove,eventjs.Gesture._gestureHandlers.pointerup=e.pointerup,e}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";return e.shake=function(e){var t={gesture:"devicemotion",acceleration:{},accelerationIncludingGravity:{},target:e.target,listener:e.listener,remove:function(){window.removeEventListener("devicemotion",v,!1)}},n=4,r=1e3,o=200,i=3,s=(new Date).getTime(),a={x:0,y:0,z:0},u={x:{count:0,value:0},y:{count:0,value:0},z:{count:0,value:0}},v=function(v){var d=.8,f=v.accelerationIncludingGravity;if(a.x=d*a.x+(1-d)*f.x,a.y=d*a.y+(1-d)*f.y,a.z=d*a.z+(1-d)*f.z,t.accelerationIncludingGravity=a,t.acceleration.x=f.x-a.x,t.acceleration.y=f.y-a.y,t.acceleration.z=f.z-a.z,"devicemotion"===e.gesture)return void e.listener(v,t);for(var c="xyz",l=(new Date).getTime(),p=0,g=c.length;g>p;p++){var m=c[p],y=t.acceleration[m],j=u[m],w=Math.abs(y);if(!(r>l-s)&&w>n){var h=l*y/w,b=Math.abs(h+j.value);j.value&&o>b?(j.value=h,j.count++,j.count===i&&(e.listener(v,t),s=l,j.value=0,j.count=0)):(j.value=h,j.count=1)}}};return window.addEventListener?(window.addEventListener("devicemotion",v,!1),t):void 0},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.shake=e.shake,e}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";var t=Math.PI/180;return e.swipe=function(n){n.snap=n.snap||90,n.threshold=n.threshold||1,n.gesture=n.gesture||"swipe",n.onPointerDown=function(t){e.pointerStart(t,r,n)&&(eventjs.add(n.doc,"mousemove",n.onPointerMove).listener(t),eventjs.add(n.doc,"mouseup",n.onPointerUp))},n.onPointerMove=function(t){for(var r=t.changedTouches||e.getCoords(t),o=r.length,i=0;o>i;i++){var s=r[i],a=s.identifier||1/0,u=n.tracker[a];u&&(u.move.x=s.pageX,u.move.y=s.pageY,u.moveTime=(new Date).getTime())}},n.onPointerUp=function(o){if(e.pointerEnd(o,r,n)){eventjs.remove(n.doc,"mousemove",n.onPointerMove),eventjs.remove(n.doc,"mouseup",n.onPointerUp);var i,s,a,u,v={x:0,y:0},d=0,f=0,c=0;for(var l in n.tracker){var p=n.tracker[l],g=p.move.x-p.start.x,m=p.move.y-p.start.y;d+=p.move.x,f+=p.move.y,v.x+=p.start.x,v.y+=p.start.y,c++;var y=Math.sqrt(g*g+m*m),j=p.moveTime-p.startTime,u=Math.atan2(g,m)/t+180,s=j?y/j:0;if("undefined"==typeof a)a=u,i=s;else{if(!(Math.abs(u-a)<=20))return;a=(a+u)/2,i=(i+s)/2}}var w=n.gestureFingers;n.minFingers<=w&&n.maxFingers>=w&&i>n.threshold&&(v.x/=c,v.y/=c,r.start=v,r.x=d/c,r.y=f/c,r.angle=-(((a/n.snap+.5>>0)*n.snap||360)-360),r.velocity=i,r.fingers=w,r.state="swipe",n.listener(o,r))}};var r=e.pointerSetup(n);return eventjs.add(n.target,"mousedown",n.onPointerDown),r},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.swipe=e.swipe,e}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";return e.longpress=function(t){return t.gesture="longpress",e.tap(t)},e.tap=function(t){t.delay=t.delay||500,t.timeout=t.timeout||250,t.driftDeviance=t.driftDeviance||10,t.gesture=t.gesture||"tap";var n,r;t.onPointerDown=function(i){if(e.pointerStart(i,o,t)){if(n=(new Date).getTime(),eventjs.add(t.doc,"mousemove",t.onPointerMove).listener(i),eventjs.add(t.doc,"mouseup",t.onPointerUp),"longpress"!==t.gesture)return;r=setTimeout(function(){if(!(i.cancelBubble&&++i.cancelBubbleCount>1)){var e=0;for(var n in t.tracker){var r=t.tracker[n];if(r.end===!0)return;if(t.cancel)return;e++}t.minFingers<=e&&t.maxFingers>=e&&(o.state="start",o.fingers=e,o.x=r.start.x,o.y=r.start.y,t.listener(i,o))}},t.delay)}},t.onPointerMove=function(n){for(var r=t.bbox,o=n.changedTouches||e.getCoords(n),i=o.length,s=0;i>s;s++){var a=o[s],u=a.identifier||1/0,v=t.tracker[u];if(v){var d=a.pageX-r.x1,f=a.pageY-r.y1,c=d-v.start.x,l=f-v.start.y,p=Math.sqrt(c*c+l*l);if(!(d>0&&d<r.width&&f>0&&f<r.height&&p<=t.driftDeviance))return eventjs.remove(t.doc,"mousemove",t.onPointerMove),void(t.cancel=!0)}}},t.onPointerUp=function(i){if(e.pointerEnd(i,o,t)){if(clearTimeout(r),eventjs.remove(t.doc,"mousemove",t.onPointerMove),eventjs.remove(t.doc,"mouseup",t.onPointerUp),i.cancelBubble&&++i.cancelBubbleCount>1)return;if("longpress"===t.gesture)return void("start"===o.state&&(o.state="end",t.listener(i,o)));if(t.cancel)return;if((new Date).getTime()-n>t.timeout)return;var s=t.gestureFingers;t.minFingers<=s&&t.maxFingers>=s&&(o.state="tap",o.fingers=t.gestureFingers,t.listener(i,o))}};var o=e.pointerSetup(t);return eventjs.add(t.target,"mousedown",t.onPointerDown),o},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.tap=e.tap,eventjs.Gesture._gestureHandlers.longpress=e.longpress,e}(eventjs.proxy),"undefined"==typeof eventjs)var eventjs={};if("undefined"==typeof eventjs.proxy&&(eventjs.proxy={}),eventjs.proxy=function(e){"use strict";return e.wheelPreventElasticBounce=function(e){e&&("string"==typeof e&&(e=document.querySelector(e)),eventjs.add(e,"wheel",function(e,t){t.preventElasticBounce(),eventjs.stop(e)}))},e.wheel=function(e){var t,n=e.timeout||150,r=0,o={gesture:"wheel",state:"start",wheelDelta:0,target:e.target,listener:e.listener,preventElasticBounce:function(e){var t=this.target,n=t.scrollTop,r=n+t.offsetHeight,o=t.scrollHeight;r===o&&this.wheelDelta<=0?eventjs.cancel(e):0===n&&this.wheelDelta>=0&&eventjs.cancel(e),eventjs.stop(e)},add:function(){e.target[s](u,i,!1)},remove:function(){e.target[a](u,i,!1)}},i=function(i){i=i||window.event,o.state=r++?"change":"start",o.wheelDelta=i.detail?-20*i.detail:i.wheelDelta,e.listener(i,o),clearTimeout(t),t=setTimeout(function(){r=0,o.state="end",o.wheelDelta=0,e.listener(i,o)},n)},s=document.addEventListener?"addEventListener":"attachEvent",a=document.removeEventListener?"removeEventListener":"detachEvent",u=eventjs.getEventSupport("mousewheel")?"mousewheel":"DOMMouseScroll";return e.target[s](u,i,!1),o},eventjs.Gesture=eventjs.Gesture||{},eventjs.Gesture._gestureHandlers=eventjs.Gesture._gestureHandlers||{},eventjs.Gesture._gestureHandlers.wheel=e.wheel,e}(eventjs.proxy),"undefined"==typeof Event)var Event={};"undefined"==typeof Event.proxy&&(Event.proxy={}),Event.proxy=function(e){"use strict";return e.orientation=function(e){var t={gesture:"orientationchange",previous:null,current:window.orientation,target:e.target,listener:e.listener,remove:function(){window.removeEventListener("orientationchange",n,!1)}},n=function(n){return t.previous=t.current,t.current=window.orientation,null!==t.previous&&t.previous!=t.current?void e.listener(n,t):void 0};return window.DeviceOrientationEvent&&window.addEventListener("orientationchange",n,!1),t},Event.Gesture=Event.Gesture||{},Event.Gesture._gestureHandlers=Event.Gesture._gestureHandlers||{},Event.Gesture._gestureHandlers.orientation=e.orientation,e}(Event.proxy);!function(){function e(e,t){if(this.__eventListeners[e]){var n=this.__eventListeners[e];t?n[n.indexOf(t)]=!1:fabric.util.array.fill(n,!1)}}function t(e,t){if(this.__eventListeners||(this.__eventListeners={}),1===arguments.length)for(var n in e)this.on(n,e[n]);else this.__eventListeners[e]||(this.__eventListeners[e]=[]),this.__eventListeners[e].push(t);return this}function n(t,n){if(this.__eventListeners){if(0===arguments.length)for(t in this.__eventListeners)e.call(this,t);else if(1===arguments.length&&"object"==typeof arguments[0])for(var r in t)e.call(this,r,t[r]);else e.call(this,t,n);return this}}function r(e,t){if(this.__eventListeners){var n=this.__eventListeners[e];if(n){for(var r=0,i=n.length;i>r;r++)n[r]&&n[r].call(this,t||{});return this.__eventListeners[e]=n.filter(function(e){return e!==!1}),this}}}fabric.Observable={observe:t,stopObserving:n,fire:r,on:t,off:n,trigger:r}}();fabric.Collection={_objects:[],add:function(){if(this._objects.push.apply(this._objects,arguments),this._onObjectAdded)for(var e=0,t=arguments.length;t>e;e++)this._onObjectAdded(arguments[e]);return this.renderOnAddRemove&&this.requestRenderAll(),this},insertAt:function(e,t,n){var r=this.getObjects();return n?r[t]=e:r.splice(t,0,e),this._onObjectAdded&&this._onObjectAdded(e),this.renderOnAddRemove&&this.requestRenderAll(),this},remove:function(){for(var e,t=this.getObjects(),n=!1,r=0,i=arguments.length;i>r;r++)e=t.indexOf(arguments[r]),-1!==e&&(n=!0,t.splice(e,1),this._onObjectRemoved&&this._onObjectRemoved(arguments[r]));return this.renderOnAddRemove&&n&&this.requestRenderAll(),this},forEachObject:function(e,t){for(var n=this.getObjects(),r=0,i=n.length;i>r;r++)e.call(t,n[r],r,n);return this},getObjects:function(e){return"undefined"==typeof e?this._objects:this._objects.filter(function(t){return t.type===e})},item:function(e){return this.getObjects()[e]},isEmpty:function(){return 0===this.getObjects().length},size:function(){return this.getObjects().length},contains:function(e){return this.getObjects().indexOf(e)>-1},complexity:function(){return this.getObjects().reduce(function(e,t){return e+=t.complexity?t.complexity():0},0)}};fabric.CommonMethods={_setOptions:function(t){for(var e in t)this.set(e,t[e])},_initGradient:function(t,e){!t||!t.colorStops||t instanceof fabric.Gradient||this.set(e,new fabric.Gradient(t))},_initPattern:function(t,e,i){!t||!t.source||t instanceof fabric.Pattern?i&&i():this.set(e,new fabric.Pattern(t,i))},_initClipping:function(t){if(t.clipTo&&"string"==typeof t.clipTo){var e=fabric.util.getFunctionBody(t.clipTo);"undefined"!=typeof e&&(this.clipTo=new Function("ctx",e))}},_setObject:function(t){for(var e in t)this._set(e,t[e])},set:function(t,e){return"object"==typeof t?this._setObject(t):"function"==typeof e&&"clipTo"!==t?this._set(t,e(this.get(t))):this._set(t,e),this},_set:function(t,e){this[t]=e},toggle:function(t){var e=this.get(t);return"boolean"==typeof e&&this.set(t,!e),this},get:function(t){return this[t]}};!function(t){var e=Math.sqrt,i=Math.atan2,n=Math.pow,r=Math.abs,s=Math.PI/180,o=Math.PI/2;fabric.util={cos:function(t){if(0===t)return 1;0>t&&(t=-t);var e=t/o;switch(e){case 1:case 3:return 0;case 2:return-1}return Math.cos(t)},sin:function(t){if(0===t)return 0;var e=t/o,i=1;switch(0>t&&(i=-1),e){case 1:return i;case 2:return 0;case 3:return-i}return Math.sin(t)},removeFromArray:function(t,e){var i=t.indexOf(e);return-1!==i&&t.splice(i,1),t},getRandomInt:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},degreesToRadians:function(t){return t*s},radiansToDegrees:function(t){return t/s},rotatePoint:function(t,e,i){t.subtractEquals(e);var n=fabric.util.rotateVector(t,i);return new fabric.Point(n.x,n.y).addEquals(e)},rotateVector:function(t,e){var i=fabric.util.sin(e),n=fabric.util.cos(e),r=t.x*n-t.y*i,s=t.x*i+t.y*n;return{x:r,y:s}},transformPoint:function(t,e,i){return i?new fabric.Point(e[0]*t.x+e[2]*t.y,e[1]*t.x+e[3]*t.y):new fabric.Point(e[0]*t.x+e[2]*t.y+e[4],e[1]*t.x+e[3]*t.y+e[5])},makeBoundingBoxFromPoints:function(t){var e=[t[0].x,t[1].x,t[2].x,t[3].x],i=fabric.util.array.min(e),n=fabric.util.array.max(e),r=n-i,s=[t[0].y,t[1].y,t[2].y,t[3].y],o=fabric.util.array.min(s),a=fabric.util.array.max(s),c=a-o;return{left:i,top:o,width:r,height:c}},invertTransform:function(t){var e=1/(t[0]*t[3]-t[1]*t[2]),i=[e*t[3],-e*t[1],-e*t[2],e*t[0]],n=fabric.util.transformPoint({x:t[4],y:t[5]},i,!0);return i[4]=-n.x,i[5]=-n.y,i},toFixed:function(t,e){return parseFloat(Number(t).toFixed(e))},parseUnit:function(t,e){var i=/\D{0,2}$/.exec(t),n=parseFloat(t);switch(e||(e=fabric.Text.DEFAULT_SVG_FONT_SIZE),i[0]){case"mm":return n*fabric.DPI/25.4;case"cm":return n*fabric.DPI/2.54;case"in":return n*fabric.DPI;case"pt":return n*fabric.DPI/72;case"pc":return n*fabric.DPI/72*12;case"em":return n*e;default:return n}},falseFunction:function(){return!1},getKlass:function(t,e){return t=fabric.util.string.camelize(t.charAt(0).toUpperCase()+t.slice(1)),fabric.util.resolveNamespace(e)[t]},getSvgAttributes:function(t){var e=["instantiated_by_use","style","id","class"];switch(t){case"linearGradient":e=e.concat(["x1","y1","x2","y2","gradientUnits","gradientTransform"]);break;case"radialGradient":e=e.concat(["gradientUnits","gradientTransform","cx","cy","r","fx","fy","fr"]);break;case"stop":e=e.concat(["offset","stop-color","stop-opacity"])}return e},resolveNamespace:function(e){if(!e)return fabric;var i,n=e.split("."),r=n.length,s=t||fabric.window;for(i=0;r>i;++i)s=s[n[i]];return s},loadImage:function(t,e,i,n){if(!t)return void(e&&e.call(i,t));var r=fabric.util.createImage(),s=function(){e&&e.call(i,r),r=r.onload=r.onerror=null};r.onload=s,r.onerror=function(){fabric.log("Error loading "+r.src),e&&e.call(i,null,!0),r=r.onload=r.onerror=null},0!==t.indexOf("data")&&n&&(r.crossOrigin=n),"data:image/svg"===t.substring(0,14)&&(r.onload=null,fabric.util.loadImageInDom(r,s)),r.src=t},loadImageInDom:function(t,e){var i=fabric.document.createElement("div");i.style.width=i.style.height="1px",i.style.left=i.style.top="-100%",i.style.position="absolute",i.appendChild(t),fabric.document.querySelector("body").appendChild(i),t.onload=function(){e(),i.parentNode.removeChild(i),i=null}},enlivenObjects:function(t,e,i,n){function r(){++o===a&&e&&e(s)}t=t||[];var s=[],o=0,a=t.length;return a?void t.forEach(function(t,e){if(!t||!t.type)return void r();var o=fabric.util.getKlass(t.type,i);o.fromObject(t,function(i,o){o||(s[e]=i),n&&n(t,i,o),r()})}):void(e&&e(s))},enlivenPatterns:function(t,e){function i(){++r===s&&e&&e(n)}t=t||[];var n=[],r=0,s=t.length;return s?void t.forEach(function(t,e){t&&t.source?new fabric.Pattern(t,function(t){n[e]=t,i()}):(n[e]=t,i())}):void(e&&e(n))},groupSVGElements:function(t,e,i){var n;return 1===t.length?t[0]:(e&&(e.width&&e.height?e.centerPoint={x:e.width/2,y:e.height/2}:(delete e.width,delete e.height)),n=new fabric.Group(t,e),"undefined"!=typeof i&&(n.sourcePath=i),n)},populateWithProperties:function(t,e,i){if(i&&"[object Array]"===Object.prototype.toString.call(i))for(var n=0,r=i.length;r>n;n++)i[n]in t&&(e[i[n]]=t[i[n]])},drawDashedLine:function(t,n,r,s,o,a){var c=s-n,h=o-r,l=e(c*c+h*h),u=i(h,c),f=a.length,d=0,v=!0;for(t.save(),t.translate(n,r),t.moveTo(0,0),t.rotate(u),n=0;l>n;)n+=a[d++%f],n>l&&(n=l),t[v?"lineTo":"moveTo"](n,0),v=!v;t.restore()},createCanvasElement:function(){return fabric.document.createElement("canvas")},createImage:function(){return fabric.document.createElement("img")},clipContext:function(t,e){e.save(),e.beginPath(),t.clipTo(e),e.clip()},multiplyTransformMatrices:function(t,e,i){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],i?0:t[0]*e[4]+t[2]*e[5]+t[4],i?0:t[1]*e[4]+t[3]*e[5]+t[5]]},qrDecompose:function(t){var r=i(t[1],t[0]),o=n(t[0],2)+n(t[1],2),a=e(o),c=(t[0]*t[3]-t[2]*t[1])/a,h=i(t[0]*t[2]+t[1]*t[3],o);return{angle:r/s,scaleX:a,scaleY:c,skewX:h/s,skewY:0,translateX:t[4],translateY:t[5]}},customTransformMatrix:function(t,e,i){var n=[1,0,r(Math.tan(i*s)),1],o=[r(t),0,0,r(e)];return fabric.util.multiplyTransformMatrices(o,n,!0)},resetObjectTransform:function(t){t.scaleX=1,t.scaleY=1,t.skewX=0,t.skewY=0,t.flipX=!1,t.flipY=!1,t.rotate(0)},getFunctionBody:function(t){return(String(t).match(/function[^{]*\{([\s\S]*)\}/)||{})[1]},isTransparent:function(t,e,i,n){n>0&&(e>n?e-=n:e=0,i>n?i-=n:i=0);var r,s,o=!0,a=t.getImageData(e,i,2*n||1,2*n||1),c=a.data.length;for(r=3;c>r&&(s=a.data[r],o=0>=s,o!==!1);r+=4);return a=null,o},parsePreserveAspectRatioAttribute:function(t){var e,i="meet",n="Mid",r="Mid",s=t.split(" ");return s&&s.length&&(i=s.pop(),"meet"!==i&&"slice"!==i?(e=i,i="meet"):s.length&&(e=s.pop())),n="none"!==e?e.slice(1,4):"none",r="none"!==e?e.slice(5,8):"none",{meetOrSlice:i,alignX:n,alignY:r}},clearFabricFontCache:function(t){t=(t||"").toLowerCase(),t?fabric.charWidthsCache[t]&&delete fabric.charWidthsCache[t]:fabric.charWidthsCache={}},limitDimsByArea:function(t,e){var i=Math.sqrt(e*t),n=Math.floor(e/i);return{x:Math.floor(i),y:n}},capValue:function(t,e,i){return Math.max(t,Math.min(e,i))},findScaleToFit:function(t,e){return Math.min(e.width/t.width,e.height/t.height)},findScaleToCover:function(t,e){return Math.max(e.width/t.width,e.height/t.height)}}}("undefined"!=typeof exports?exports:this);!function(){function t(t,n,s,o,c,h,l){var u=a.call(arguments);if(r[u])return r[u];var f=Math.PI,d=l*f/180,v=fabric.util.sin(d),g=fabric.util.cos(d),p=0,b=0;s=Math.abs(s),o=Math.abs(o);var m=-g*t*.5-v*n*.5,y=-g*n*.5+v*t*.5,_=s*s,w=o*o,C=y*y,x=m*m,j=_*w-_*C-w*x,O=0;if(0>j){var S=Math.sqrt(1-j/(_*w));s*=S,o*=S}else O=(c===h?-1:1)*Math.sqrt(j/(_*C+w*x));var T=O*s*y/o,P=-O*o*m/s,k=g*T-v*P+.5*t,E=v*T+g*P+.5*n,D=i(1,0,(m-T)/s,(y-P)/o),M=i((m-T)/s,(y-P)/o,(-m-T)/s,(-y-P)/o);0===h&&M>0?M-=2*f:1===h&&0>M&&(M+=2*f);for(var F=Math.ceil(Math.abs(M/f*2)),A=[],X=M/F,Y=8/3*Math.sin(X/4)*Math.sin(X/4)/Math.sin(X/2),L=D+X,R=0;F>R;R++)A[R]=e(D,L,g,v,s,o,k,E,Y,p,b),p=A[R][4],b=A[R][5],D=L,L+=X;return r[u]=A,A}function e(t,e,i,n,r,o,c,h,l,u,f){var d=a.call(arguments);if(s[d])return s[d];var v=fabric.util.cos(t),g=fabric.util.sin(t),p=fabric.util.cos(e),b=fabric.util.sin(e),m=i*r*p-n*o*b+c,y=n*r*p+i*o*b+h,_=u+l*(-i*r*g-n*o*v),w=f+l*(-n*r*g+i*o*v),C=m+l*(i*r*b+n*o*p),x=y+l*(n*r*b-i*o*p);return s[d]=[_,w,C,x,m,y],s[d]}function i(t,e,i,n){var r=Math.atan2(e,t),s=Math.atan2(n,i);return s>=r?s-r:2*Math.PI-(r-s)}function n(t,e,i,n,r,s,c,h){var l=a.call(arguments);if(o[l])return o[l];var u,f,d,v,g,p,b,m,y=Math.sqrt,_=Math.min,w=Math.max,C=Math.abs,x=[],j=[[],[]];f=6*t-12*i+6*r,u=-3*t+9*i-9*r+3*c,d=3*i-3*t;for(var O=0;2>O;++O)if(O>0&&(f=6*e-12*n+6*s,u=-3*e+9*n-9*s+3*h,d=3*n-3*e),C(u)<1e-12){if(C(f)<1e-12)continue;v=-d/f,v>0&&1>v&&x.push(v)}else b=f*f-4*d*u,0>b||(m=y(b),g=(-f+m)/(2*u),g>0&&1>g&&x.push(g),p=(-f-m)/(2*u),p>0&&1>p&&x.push(p));for(var S,T,P,k=x.length,E=k;k--;)v=x[k],P=1-v,S=P*P*P*t+3*P*P*v*i+3*P*v*v*r+v*v*v*c,j[0][k]=S,T=P*P*P*e+3*P*P*v*n+3*P*v*v*s+v*v*v*h,j[1][k]=T;j[0][E]=t,j[1][E]=e,j[0][E+1]=c,j[1][E+1]=h;var D=[{x:_.apply(null,j[0]),y:_.apply(null,j[1])},{x:w.apply(null,j[0]),y:w.apply(null,j[1])}];return o[l]=D,D}var r={},s={},o={},a=Array.prototype.join;fabric.util.drawArc=function(e,i,n,r){for(var s=r[0],o=r[1],a=r[2],c=r[3],h=r[4],l=r[5],u=r[6],f=[[],[],[],[]],d=t(l-i,u-n,s,o,c,h,a),v=0,g=d.length;g>v;v++)f[v][0]=d[v][0]+i,f[v][1]=d[v][1]+n,f[v][2]=d[v][2]+i,f[v][3]=d[v][3]+n,f[v][4]=d[v][4]+i,f[v][5]=d[v][5]+n,e.bezierCurveTo.apply(e,f[v])},fabric.util.getBoundsOfArc=function(e,i,r,s,o,a,c,h,l){for(var u,f=0,d=0,v=[],g=t(h-e,l-i,r,s,a,c,o),p=0,b=g.length;b>p;p++)u=n(f,d,g[p][0],g[p][1],g[p][2],g[p][3],g[p][4],g[p][5]),v.push({x:u[0].x+e,y:u[0].y+i}),v.push({x:u[1].x+e,y:u[1].y+i}),f=g[p][4],d=g[p][5];return v},fabric.util.getBoundsOfCurve=n}();!function(){function t(t,e){for(var i=s.call(arguments,2),n=[],r=0,o=t.length;o>r;r++)n[r]=i.length?t[r][e].apply(t[r],i):t[r][e].call(t[r]);return n}function e(t,e){return r(t,e,function(t,e){return t>=e})}function i(t,e){return r(t,e,function(t,e){return e>t})}function n(t,e){for(var i=t.length;i--;)t[i]=e;return t}function r(t,e,i){if(t&&0!==t.length){var n=t.length-1,r=e?t[n][e]:t[n];if(e)for(;n--;)i(t[n][e],r)&&(r=t[n][e]);else for(;n--;)i(t[n],r)&&(r=t[n]);return r}}var s=Array.prototype.slice;fabric.util.array={fill:n,invoke:t,min:i,max:e}}();!function(){function t(e,i,n){if(n)if(!fabric.isLikelyNode&&i instanceof Element)e=i;else if(i instanceof Array){e=[];for(var r=0,s=i.length;s>r;r++)e[r]=t({},i[r],n)}else if(i&&"object"==typeof i)for(var o in i)i.hasOwnProperty(o)&&(e[o]=t({},i[o],n));else e=i;else for(var o in i)e[o]=i[o];return e}function e(e,i){return t({},e,i)}fabric.util.object={extend:t,clone:e},fabric.util.object.extend(fabric.util,fabric.Observable)}();!function(){function t(t){return t.replace(/-+(.)?/g,function(t,e){return e?e.toUpperCase():""})}function e(t,e){return t.charAt(0).toUpperCase()+(e?t.slice(1):t.slice(1).toLowerCase())}function i(t){return t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function r(t){var e,i=0,r=[];for(i=0,e;i<t.length;i++)(e=n(t,i))!==!1&&r.push(e);return r}function n(t,e){var i=t.charCodeAt(e);if(isNaN(i))return"";if(55296>i||i>57343)return t.charAt(e);if(i>=55296&&56319>=i){if(t.length<=e+1)throw"High surrogate without following low surrogate";var r=t.charCodeAt(e+1);if(56320>r||r>57343)throw"High surrogate without following low surrogate";return t.charAt(e)+t.charAt(e+1)}if(0===e)throw"Low surrogate without preceding high surrogate";var n=t.charCodeAt(e-1);if(55296>n||n>56319)throw"Low surrogate without preceding high surrogate";return!1}fabric.util.string={camelize:t,capitalize:e,escapeXml:i,graphemeSplit:r}}();!function(){function t(){}function e(t){for(var e=null,i=this;i.constructor.superclass;){var n=i.constructor.superclass.prototype[t];if(i[t]!==n){e=n;break}i=i.constructor.superclass.prototype}return e?arguments.length>1?e.apply(this,r.call(arguments,1)):e.call(this):console.log("tried to callSuper "+t+", method not found in prototype chain",this)}function i(){function i(){this.initialize.apply(this,arguments)}var s=null,a=r.call(arguments,0);"function"==typeof a[0]&&(s=a.shift()),i.superclass=s,i.subclasses=[],s&&(t.prototype=s.prototype,i.prototype=new t,s.subclasses.push(i));for(var c=0,l=a.length;l>c;c++)o(i,a[c],s);return i.prototype.initialize||(i.prototype.initialize=n),i.prototype.constructor=i,i.prototype.callSuper=e,i}var r=Array.prototype.slice,n=function(){},s=function(){for(var t in{toString:1})if("toString"===t)return!1;return!0}(),o=function(t,e,i){for(var r in e)t.prototype[r]=r in t.prototype&&"function"==typeof t.prototype[r]&&(e[r]+"").indexOf("callSuper")>-1?function(t){return function(){var r=this.constructor.superclass;this.constructor.superclass=i;var n=e[t].apply(this,arguments);return this.constructor.superclass=r,"initialize"!==t?n:void 0}}(r):e[r],s&&(e.toString!==Object.prototype.toString&&(t.prototype.toString=e.toString),e.valueOf!==Object.prototype.valueOf&&(t.prototype.valueOf=e.valueOf))};fabric.util.createClass=i}();!function(){function e(e){var i,n,r=Array.prototype.slice.call(arguments,1),t=r.length;for(n=0;t>n;n++)if(i=typeof e[r[n]],!/^(?:function|object|unknown)$/.test(i))return!1;return!0}function i(e,i){return{handler:i,wrappedHandler:n(e,i)}}function n(e,i){return function(n){i.call(c(e),n||fabric.window.event)}}function r(e,i){return function(n){if(m[e]&&m[e][i])for(var r=m[e][i],t=0,a=r.length;a>t;t++)r[t].call(this,n||fabric.window.event)}}function t(e){e||(e=fabric.window.event);var i=e.target||(typeof e.srcElement!==f?e.srcElement:null),n=fabric.util.getScrollLeftTop(i);return{x:p(e)+n.left,y:w(e)+n.top}}function a(e,i,n){var r,t="touchend"===e.type?"changedTouches":"touches",a=e[t];return a&&a[0]&&(r=a[0][n]),"undefined"==typeof r&&(r=e[n]),r}var c,o,f="unknown",u=function(){var e=0;return function(i){return i.__uniqueID||(i.__uniqueID="uniqueID__"+e++)}}();!function(){var e={};c=function(i){return e[i]},o=function(i,n){e[i]=n}}();var d,l,b=e(fabric.document.documentElement,"addEventListener","removeEventListener")&&e(fabric.window,"addEventListener","removeEventListener"),s=e(fabric.document.documentElement,"attachEvent","detachEvent")&&e(fabric.window,"attachEvent","detachEvent"),v={},m={};b?(d=function(e,i,n,r){e&&e.addEventListener(i,n,s?!1:r)},l=function(e,i,n,r){e&&e.removeEventListener(i,n,s?!1:r)}):s?(d=function(e,n,r){if(e){var t=u(e);o(t,e),v[t]||(v[t]={}),v[t][n]||(v[t][n]=[]);var a=i(t,r);v[t][n].push(a),e.attachEvent("on"+n,a.wrappedHandler)}},l=function(e,i,n){if(e){var r,t=u(e);if(v[t]&&v[t][i])for(var a=0,c=v[t][i].length;c>a;a++)r=v[t][i][a],r&&r.handler===n&&(e.detachEvent("on"+i,r.wrappedHandler),v[t][i][a]=null)}}):(d=function(e,i,n){if(e){var t=u(e);if(m[t]||(m[t]={}),!m[t][i]){m[t][i]=[];var a=e["on"+i];a&&m[t][i].push(a),e["on"+i]=r(t,i)}m[t][i].push(n)}},l=function(e,i,n){if(e){var r=u(e);if(m[r]&&m[r][i])for(var t=m[r][i],a=0,c=t.length;c>a;a++)t[a]===n&&t.splice(a,1)}}),fabric.util.addListener=d,fabric.util.removeListener=l;var p=function(e){return e.clientX},w=function(e){return e.clientY};fabric.isTouchSupported&&(p=function(e){return a(e,"pageX","clientX")},w=function(e){return a(e,"pageY","clientY")}),fabric.util.getPointer=t}();!function(){function e(e,t){var n=e.style;if(!n)return e;if("string"==typeof t)return e.style.cssText+=";"+t,t.indexOf("opacity")>-1?i(e,t.match(/opacity:\s*(\d?\.?\d*)/)[1]):e;for(var r in t)if("opacity"===r)i(e,t[r]);else{var o="float"===r||"cssFloat"===r?"undefined"==typeof n.styleFloat?"cssFloat":"styleFloat":r;n[o]=t[r]}return e}var t=fabric.document.createElement("div"),n="string"==typeof t.style.opacity,r="string"==typeof t.style.filter,o=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,i=function(e){return e};n?i=function(e,t){return e.style.opacity=t,e}:r&&(i=function(e,t){var n=e.style;return e.currentStyle&&!e.currentStyle.hasLayout&&(n.zoom=1),o.test(n.filter)?(t=t>=.9999?"":"alpha(opacity="+100*t+")",n.filter=n.filter.replace(o,t)):n.filter+=" alpha(opacity="+100*t+")",e}),fabric.util.setStyle=e}();!function(){function e(e){return"string"==typeof e?fabric.document.getElementById(e):e}function t(e,t){var n=fabric.document.createElement(e);for(var r in t)"class"===r?n.className=t[r]:"for"===r?n.htmlFor=t[r]:n.setAttribute(r,t[r]);return n}function n(e,t){e&&-1===(" "+e.className+" ").indexOf(" "+t+" ")&&(e.className+=(e.className?" ":"")+t)}function r(e,n,r){return"string"==typeof n&&(n=t(n,r)),e.parentNode&&e.parentNode.replaceChild(n,e),n.appendChild(e),n}function o(e){for(var t=0,n=0,r=fabric.document.documentElement,o=fabric.document.body||{scrollLeft:0,scrollTop:0};e&&(e.parentNode||e.host)&&(e=e.parentNode||e.host,e===fabric.document?(t=o.scrollLeft||r.scrollLeft||0,n=o.scrollTop||r.scrollTop||0):(t+=e.scrollLeft||0,n+=e.scrollTop||0),1!==e.nodeType||"fixed"!==e.style.position););return{left:t,top:n}}function i(e){var t,n,r=e&&e.ownerDocument,i={left:0,top:0},s={left:0,top:0},a={borderLeftWidth:"left",borderTopWidth:"top",paddingLeft:"left",paddingTop:"top"};if(!r)return s;for(var u in a)s[a[u]]+=parseInt(d(e,u),10)||0;return t=r.documentElement,"undefined"!=typeof e.getBoundingClientRect&&(i=e.getBoundingClientRect()),n=o(e),{left:i.left+n.left-(t.clientLeft||0)+s.left,top:i.top+n.top-(t.clientTop||0)+s.top}}function s(e){var t=fabric.jsdomImplForWrapper(e);return t._canvas||t._image}var a,u=Array.prototype.slice,c=function(e){return u.call(e,0)};try{a=c(fabric.document.childNodes)instanceof Array}catch(f){}a||(c=function(e){for(var t=new Array(e.length),n=e.length;n--;)t[n]=e[n];return t});var d;d=fabric.document.defaultView&&fabric.document.defaultView.getComputedStyle?function(e,t){var n=fabric.document.defaultView.getComputedStyle(e,null);return n?n[t]:void 0}:function(e,t){var n=e.style[t];return!n&&e.currentStyle&&(n=e.currentStyle[t]),n},function(){function e(e){return"undefined"!=typeof e.onselectstart&&(e.onselectstart=fabric.util.falseFunction),r?e.style[r]="none":"string"==typeof e.unselectable&&(e.unselectable="on"),e}function t(e){return"undefined"!=typeof e.onselectstart&&(e.onselectstart=null),r?e.style[r]="":"string"==typeof e.unselectable&&(e.unselectable=""),e}var n=fabric.document.documentElement.style,r="userSelect"in n?"userSelect":"MozUserSelect"in n?"MozUserSelect":"WebkitUserSelect"in n?"WebkitUserSelect":"KhtmlUserSelect"in n?"KhtmlUserSelect":"";fabric.util.makeElementUnselectable=e,fabric.util.makeElementSelectable=t}(),function(){function e(e,t){var n=fabric.document.getElementsByTagName("head")[0],r=fabric.document.createElement("script"),o=!0;r.onload=r.onreadystatechange=function(e){if(o){if("string"==typeof this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState)return;o=!1,t(e||fabric.window.event),r=r.onload=r.onreadystatechange=null}},r.src=e,n.appendChild(r)}fabric.util.getScript=e}(),fabric.util.getById=e,fabric.util.toArray=c,fabric.util.makeElement=t,fabric.util.addClass=n,fabric.util.wrapElement=r,fabric.util.getScrollLeftTop=o,fabric.util.getElementOffset=i,fabric.util.getElementStyle=d,fabric.util.getNodeCanvas=s}();!function(){function e(e,t){return e+(/\?/.test(e)?"&":"?")+t}function t(){}function n(n,o){o||(o={});var i=o.method?o.method.toUpperCase():"GET",s=o.onComplete||function(){},a=r(),u=o.body||o.parameters;return a.onreadystatechange=function(){4===a.readyState&&(s(a),a.onreadystatechange=t)},"GET"===i&&(u=null,"string"==typeof o.parameters&&(n=e(n,o.parameters))),a.open(i,n,!0),("POST"===i||"PUT"===i)&&a.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.send(u),a}var r=function(){for(var e=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],t=e.length;t--;)try{var n=e[t]();if(n)return e[t]}catch(r){}}();fabric.util.request=n}();fabric.log=function(){},fabric.warn=function(){},"undefined"!=typeof console&&["log","warn"].forEach(function(e){"undefined"!=typeof console[e]&&"function"==typeof console[e].apply&&(fabric[e]=function(){return console[e].apply(console,arguments)})});!function(e){"use strict";function t(e,t){this.x=e,this.y=t}var n=e.fabric||(e.fabric={});return n.Point?void n.warn("fabric.Point is already defined"):(n.Point=t,void(t.prototype={type:"point",constructor:t,add:function(e){return new t(this.x+e.x,this.y+e.y)},addEquals:function(e){return this.x+=e.x,this.y+=e.y,this},scalarAdd:function(e){return new t(this.x+e,this.y+e)},scalarAddEquals:function(e){return this.x+=e,this.y+=e,this},subtract:function(e){return new t(this.x-e.x,this.y-e.y)},subtractEquals:function(e){return this.x-=e.x,this.y-=e.y,this},scalarSubtract:function(e){return new t(this.x-e,this.y-e)},scalarSubtractEquals:function(e){return this.x-=e,this.y-=e,this},multiply:function(e){return new t(this.x*e,this.y*e)},multiplyEquals:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return new t(this.x/e,this.y/e)},divideEquals:function(e){return this.x/=e,this.y/=e,this},eq:function(e){return this.x===e.x&&this.y===e.y},lt:function(e){return this.x<e.x&&this.y<e.y},lte:function(e){return this.x<=e.x&&this.y<=e.y},gt:function(e){return this.x>e.x&&this.y>e.y},gte:function(e){return this.x>=e.x&&this.y>=e.y},lerp:function(e,n){return"undefined"==typeof n&&(n=.5),n=Math.max(Math.min(1,n),0),new t(this.x+(e.x-this.x)*n,this.y+(e.y-this.y)*n)},distanceFrom:function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)},midPointFrom:function(e){return this.lerp(e)},min:function(e){return new t(Math.min(this.x,e.x),Math.min(this.y,e.y))},max:function(e){return new t(Math.max(this.x,e.x),Math.max(this.y,e.y))},toString:function(){return this.x+","+this.y},setXY:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setFromPoint:function(e){return this.x=e.x,this.y=e.y,this},swap:function(e){var t=this.x,n=this.y;this.x=e.x,this.y=e.y,e.x=t,e.y=n},clone:function(){return new t(this.x,this.y)}}))}("undefined"!=typeof exports?exports:this);!function(e){"use strict";function t(e){this.status=e,this.points=[]}var n=e.fabric||(e.fabric={});return n.Intersection?void n.warn("fabric.Intersection is already defined"):(n.Intersection=t,n.Intersection.prototype={constructor:t,appendPoint:function(e){return this.points.push(e),this},appendPoints:function(e){return this.points=this.points.concat(e),this}},n.Intersection.intersectLineLine=function(e,r,i,o){var s,a=(o.x-i.x)*(e.y-i.y)-(o.y-i.y)*(e.x-i.x),c=(r.x-e.x)*(e.y-i.y)-(r.y-e.y)*(e.x-i.x),u=(o.y-i.y)*(r.x-e.x)-(o.x-i.x)*(r.y-e.y);if(0!==u){var l=a/u,f=c/u;l>=0&&1>=l&&f>=0&&1>=f?(s=new t("Intersection"),s.appendPoint(new n.Point(e.x+l*(r.x-e.x),e.y+l*(r.y-e.y)))):s=new t}else s=new t(0===a||0===c?"Coincident":"Parallel");return s},n.Intersection.intersectLinePolygon=function(e,n,r){var i,o,s,a,c=new t,u=r.length;for(a=0;u>a;a++)i=r[a],o=r[(a+1)%u],s=t.intersectLineLine(e,n,i,o),c.appendPoints(s.points);return c.points.length>0&&(c.status="Intersection"),c},n.Intersection.intersectPolygonPolygon=function(e,n){var r,i=new t,o=e.length;for(r=0;o>r;r++){var s=e[r],a=e[(r+1)%o],c=t.intersectLinePolygon(s,a,n);i.appendPoints(c.points)}return i.points.length>0&&(i.status="Intersection"),i},void(n.Intersection.intersectPolygonRectangle=function(e,r,i){var o=r.min(i),s=r.max(i),a=new n.Point(s.x,o.y),c=new n.Point(o.x,s.y),u=t.intersectLinePolygon(o,a,e),l=t.intersectLinePolygon(a,s,e),f=t.intersectLinePolygon(s,c,e),h=t.intersectLinePolygon(c,o,e),d=new t;return d.appendPoints(u.points),d.appendPoints(l.points),d.appendPoints(f.points),d.appendPoints(h.points),d.points.length>0&&(d.status="Intersection"),d}))}("undefined"!=typeof exports?exports:this);!function(e){"use strict";function t(e){e?this._tryParsingColor(e):this.setSource([0,0,0,1])}function n(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+(t-e)*(2/3-n)*6:e}var r=e.fabric||(e.fabric={});return r.Color?void r.warn("fabric.Color is already defined."):(r.Color=t,r.Color.prototype={_tryParsingColor:function(e){var n;e in t.colorNameMap&&(e=t.colorNameMap[e]),"transparent"===e&&(n=[255,255,255,0]),n||(n=t.sourceFromHex(e)),n||(n=t.sourceFromRgb(e)),n||(n=t.sourceFromHsl(e)),n||(n=[0,0,0,1]),n&&this.setSource(n)},_rgbToHsl:function(e,t,n){e/=255,t/=255,n/=255;var i,o,s,a=r.util.array.max([e,t,n]),c=r.util.array.min([e,t,n]);if(s=(a+c)/2,a===c)i=o=0;else{var u=a-c;switch(o=s>.5?u/(2-a-c):u/(a+c),a){case e:i=(t-n)/u+(n>t?6:0);break;case t:i=(n-e)/u+2;break;case n:i=(e-t)/u+4}i/=6}return[Math.round(360*i),Math.round(100*o),Math.round(100*s)]},getSource:function(){return this._source},setSource:function(e){this._source=e},toRgb:function(){var e=this.getSource();return"rgb("+e[0]+","+e[1]+","+e[2]+")"},toRgba:function(){var e=this.getSource();return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"},toHsl:function(){var e=this.getSource(),t=this._rgbToHsl(e[0],e[1],e[2]);return"hsl("+t[0]+","+t[1]+"%,"+t[2]+"%)"},toHsla:function(){var e=this.getSource(),t=this._rgbToHsl(e[0],e[1],e[2]);return"hsla("+t[0]+","+t[1]+"%,"+t[2]+"%,"+e[3]+")"},toHex:function(){var e,t,n,r=this.getSource();return e=r[0].toString(16),e=1===e.length?"0"+e:e,t=r[1].toString(16),t=1===t.length?"0"+t:t,n=r[2].toString(16),n=1===n.length?"0"+n:n,e.toUpperCase()+t.toUpperCase()+n.toUpperCase()},toHexa:function(){var e,t=this.getSource();return e=Math.round(255*t[3]),e=e.toString(16),e=1===e.length?"0"+e:e,this.toHex()+e.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(e){var t=this.getSource();return t[3]=e,this.setSource(t),this},toGrayscale:function(){var e=this.getSource(),t=parseInt((.3*e[0]+.59*e[1]+.11*e[2]).toFixed(0),10),n=e[3];return this.setSource([t,t,t,n]),this},toBlackWhite:function(e){var t=this.getSource(),n=(.3*t[0]+.59*t[1]+.11*t[2]).toFixed(0),r=t[3];return e=e||127,n=Number(n)<Number(e)?0:255,this.setSource([n,n,n,r]),this},overlayWith:function(e){e instanceof t||(e=new t(e));var n,r=[],i=this.getAlpha(),o=.5,s=this.getSource(),a=e.getSource();for(n=0;3>n;n++)r.push(Math.round(s[n]*(1-o)+a[n]*o));return r[3]=i,this.setSource(r),this}},r.Color.reRGBa=/^rgba?\(\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*,\s*(\d{1,3}(?:\.\d+)?\%?)\s*(?:\s*,\s*((?:\d*\.?\d+)?)\s*)?\)$/i,r.Color.reHSLa=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3}\%)\s*,\s*(\d{1,3}\%)\s*(?:\s*,\s*(\d+(?:\.\d+)?)\s*)?\)$/i,r.Color.reHex=/^#?([0-9a-f]{8}|[0-9a-f]{6}|[0-9a-f]{4}|[0-9a-f]{3})$/i,r.Color.colorNameMap={aliceblue:"#F0F8FF",antiquewhite:"#FAEBD7",aqua:"#00FFFF",aquamarine:"#7FFFD4",azure:"#F0FFFF",beige:"#F5F5DC",bisque:"#FFE4C4",black:"#000000",blanchedalmond:"#FFEBCD",blue:"#0000FF",blueviolet:"#8A2BE2",brown:"#A52A2A",burlywood:"#DEB887",cadetblue:"#5F9EA0",chartreuse:"#7FFF00",chocolate:"#D2691E",coral:"#FF7F50",cornflowerblue:"#6495ED",cornsilk:"#FFF8DC",crimson:"#DC143C",cyan:"#00FFFF",darkblue:"#00008B",darkcyan:"#008B8B",darkgoldenrod:"#B8860B",darkgray:"#A9A9A9",darkgrey:"#A9A9A9",darkgreen:"#006400",darkkhaki:"#BDB76B",darkmagenta:"#8B008B",darkolivegreen:"#556B2F",darkorange:"#FF8C00",darkorchid:"#9932CC",darkred:"#8B0000",darksalmon:"#E9967A",darkseagreen:"#8FBC8F",darkslateblue:"#483D8B",darkslategray:"#2F4F4F",darkslategrey:"#2F4F4F",darkturquoise:"#00CED1",darkviolet:"#9400D3",deeppink:"#FF1493",deepskyblue:"#00BFFF",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1E90FF",firebrick:"#B22222",floralwhite:"#FFFAF0",forestgreen:"#228B22",fuchsia:"#FF00FF",gainsboro:"#DCDCDC",ghostwhite:"#F8F8FF",gold:"#FFD700",goldenrod:"#DAA520",gray:"#808080",grey:"#808080",green:"#008000",greenyellow:"#ADFF2F",honeydew:"#F0FFF0",hotpink:"#FF69B4",indianred:"#CD5C5C",indigo:"#4B0082",ivory:"#FFFFF0",khaki:"#F0E68C",lavender:"#E6E6FA",lavenderblush:"#FFF0F5",lawngreen:"#7CFC00",lemonchiffon:"#FFFACD",lightblue:"#ADD8E6",lightcoral:"#F08080",lightcyan:"#E0FFFF",lightgoldenrodyellow:"#FAFAD2",lightgray:"#D3D3D3",lightgrey:"#D3D3D3",lightgreen:"#90EE90",lightpink:"#FFB6C1",lightsalmon:"#FFA07A",lightseagreen:"#20B2AA",lightskyblue:"#87CEFA",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#B0C4DE",lightyellow:"#FFFFE0",lime:"#00FF00",limegreen:"#32CD32",linen:"#FAF0E6",magenta:"#FF00FF",maroon:"#800000",mediumaquamarine:"#66CDAA",mediumblue:"#0000CD",mediumorchid:"#BA55D3",mediumpurple:"#9370DB",mediumseagreen:"#3CB371",mediumslateblue:"#7B68EE",mediumspringgreen:"#00FA9A",mediumturquoise:"#48D1CC",mediumvioletred:"#C71585",midnightblue:"#191970",mintcream:"#F5FFFA",mistyrose:"#FFE4E1",moccasin:"#FFE4B5",navajowhite:"#FFDEAD",navy:"#000080",oldlace:"#FDF5E6",olive:"#808000",olivedrab:"#6B8E23",orange:"#FFA500",orangered:"#FF4500",orchid:"#DA70D6",palegoldenrod:"#EEE8AA",palegreen:"#98FB98",paleturquoise:"#AFEEEE",palevioletred:"#DB7093",papayawhip:"#FFEFD5",peachpuff:"#FFDAB9",peru:"#CD853F",pink:"#FFC0CB",plum:"#DDA0DD",powderblue:"#B0E0E6",purple:"#800080",rebeccapurple:"#663399",red:"#FF0000",rosybrown:"#BC8F8F",royalblue:"#4169E1",saddlebrown:"#8B4513",salmon:"#FA8072",sandybrown:"#F4A460",seagreen:"#2E8B57",seashell:"#FFF5EE",sienna:"#A0522D",silver:"#C0C0C0",skyblue:"#87CEEB",slateblue:"#6A5ACD",slategray:"#708090",slategrey:"#708090",snow:"#FFFAFA",springgreen:"#00FF7F",steelblue:"#4682B4",tan:"#D2B48C",teal:"#008080",thistle:"#D8BFD8",tomato:"#FF6347",turquoise:"#40E0D0",violet:"#EE82EE",wheat:"#F5DEB3",white:"#FFFFFF",whitesmoke:"#F5F5F5",yellow:"#FFFF00",yellowgreen:"#9ACD32"},r.Color.fromRgb=function(e){return t.fromSource(t.sourceFromRgb(e))},r.Color.sourceFromRgb=function(e){var n=e.match(t.reRGBa);if(n){var r=parseInt(n[1],10)/(/%$/.test(n[1])?100:1)*(/%$/.test(n[1])?255:1),i=parseInt(n[2],10)/(/%$/.test(n[2])?100:1)*(/%$/.test(n[2])?255:1),o=parseInt(n[3],10)/(/%$/.test(n[3])?100:1)*(/%$/.test(n[3])?255:1);return[parseInt(r,10),parseInt(i,10),parseInt(o,10),n[4]?parseFloat(n[4]):1]}},r.Color.fromRgba=t.fromRgb,r.Color.fromHsl=function(e){return t.fromSource(t.sourceFromHsl(e))},r.Color.sourceFromHsl=function(e){var r=e.match(t.reHSLa);if(r){var i,o,s,a=(parseFloat(r[1])%360+360)%360/360,c=parseFloat(r[2])/(/%$/.test(r[2])?100:1),u=parseFloat(r[3])/(/%$/.test(r[3])?100:1);if(0===c)i=o=s=u;else{var l=.5>=u?u*(c+1):u+c-u*c,f=2*u-l;i=n(f,l,a+1/3),o=n(f,l,a),s=n(f,l,a-1/3)}return[Math.round(255*i),Math.round(255*o),Math.round(255*s),r[4]?parseFloat(r[4]):1]}},r.Color.fromHsla=t.fromHsl,r.Color.fromHex=function(e){return t.fromSource(t.sourceFromHex(e))},r.Color.sourceFromHex=function(e){if(e.match(t.reHex)){var n=e.slice(e.indexOf("#")+1),r=3===n.length||4===n.length,i=8===n.length||4===n.length,o=r?n.charAt(0)+n.charAt(0):n.substring(0,2),s=r?n.charAt(1)+n.charAt(1):n.substring(2,4),a=r?n.charAt(2)+n.charAt(2):n.substring(4,6),c=i?r?n.charAt(3)+n.charAt(3):n.substring(6,8):"FF";return[parseInt(o,16),parseInt(s,16),parseInt(a,16),parseFloat((parseInt(c,16)/255).toFixed(2))]}},void(r.Color.fromSource=function(e){var n=new t;return n.setSource(e),n}))}("undefined"!=typeof exports?exports:this);!function(){"use strict";if(fabric.StaticCanvas)return void fabric.warn("fabric.StaticCanvas is already defined.");var e=fabric.util.object.extend,t=fabric.util.getElementOffset,n=fabric.util.removeFromArray,r=(fabric.util.toFixed,fabric.util.transformPoint),i=fabric.util.invertTransform,o=new Error("Could not initialize `canvas` element");fabric.StaticCanvas=fabric.util.createClass(fabric.CommonMethods,{initialize:function(e,t){t||(t={}),this.renderAndResetBound=this.renderAndReset.bind(this),this.requestRenderAllBound=this.requestRenderAll.bind(this),this._initStatic(e,t)},backgroundColor:"",backgroundImage:null,overlayColor:"",overlayImage:null,includeDefaultValues:!0,stateful:!1,renderOnAddRemove:!0,clipTo:null,controlsAboveOverlay:!1,allowTouchScrolling:!1,imageSmoothingEnabled:!0,viewportTransform:fabric.iMatrix.concat(),backgroundVpt:!0,overlayVpt:!0,onBeforeScaleRotate:function(){},enableRetinaScaling:!0,vptCoords:{},skipOffscreen:!0,_initStatic:function(e,t){var n=this.requestRenderAllBound;this._objects=[],this._createLowerCanvas(e),this._initOptions(t),this._setImageSmoothing(),this.interactive||this._initRetinaScaling(),t.overlayImage&&this.setOverlayImage(t.overlayImage,n),t.backgroundImage&&this.setBackgroundImage(t.backgroundImage,n),t.backgroundColor&&this.setBackgroundColor(t.backgroundColor,n),t.overlayColor&&this.setOverlayColor(t.overlayColor,n),this.calcOffset()},_isRetinaScaling:function(){return 1!==fabric.devicePixelRatio&&this.enableRetinaScaling},getRetinaScaling:function(){return this._isRetinaScaling()?fabric.devicePixelRatio:1},_initRetinaScaling:function(){this._isRetinaScaling()&&(this.lowerCanvasEl.setAttribute("width",this.width*fabric.devicePixelRatio),this.lowerCanvasEl.setAttribute("height",this.height*fabric.devicePixelRatio),this.contextContainer.scale(fabric.devicePixelRatio,fabric.devicePixelRatio))},calcOffset:function(){return this._offset=t(this.lowerCanvasEl),this},setOverlayImage:function(e,t,n){return this.__setBgOverlayImage("overlayImage",e,t,n)},setBackgroundImage:function(e,t,n){return this.__setBgOverlayImage("backgroundImage",e,t,n)},setOverlayColor:function(e,t){return this.__setBgOverlayColor("overlayColor",e,t)},setBackgroundColor:function(e,t){return this.__setBgOverlayColor("backgroundColor",e,t)},_setImageSmoothing:function(){var e=this.getContext();e.imageSmoothingEnabled=e.imageSmoothingEnabled||e.webkitImageSmoothingEnabled||e.mozImageSmoothingEnabled||e.msImageSmoothingEnabled||e.oImageSmoothingEnabled,e.imageSmoothingEnabled=this.imageSmoothingEnabled},__setBgOverlayImage:function(e,t,n,r){return"string"==typeof t?fabric.util.loadImage(t,function(t){t&&(this[e]=new fabric.Image(t,r)),n&&n(t)},this,r&&r.crossOrigin):(r&&t.setOptions(r),this[e]=t,n&&n(t)),this},__setBgOverlayColor:function(e,t,n){return this[e]=t,this._initGradient(t,e),this._initPattern(t,e,n),this},_createCanvasElement:function(){var e=fabric.util.createCanvasElement();if(!e)throw o;if(e.style||(e.style={}),"undefined"==typeof e.getContext)throw o;return e},_initOptions:function(e){this._setOptions(e),this.width=this.width||parseInt(this.lowerCanvasEl.width,10)||0,this.height=this.height||parseInt(this.lowerCanvasEl.height,10)||0,this.lowerCanvasEl.style&&(this.lowerCanvasEl.width=this.width,this.lowerCanvasEl.height=this.height,this.lowerCanvasEl.style.width=this.width+"px",this.lowerCanvasEl.style.height=this.height+"px",this.viewportTransform=this.viewportTransform.slice())},_createLowerCanvas:function(e){this.lowerCanvasEl=e&&e.getContext?e:fabric.util.getById(e)||this._createCanvasElement(),fabric.util.addClass(this.lowerCanvasEl,"lower-canvas"),this.interactive&&this._applyCanvasStyle(this.lowerCanvasEl),this.contextContainer=this.lowerCanvasEl.getContext("2d")},getWidth:function(){return this.width},getHeight:function(){return this.height},setWidth:function(e,t){return this.setDimensions({width:e},t)},setHeight:function(e,t){return this.setDimensions({height:e},t)},setDimensions:function(e,t){var n;t=t||{};for(var r in e)n=e[r],t.cssOnly||(this._setBackstoreDimension(r,e[r]),n+="px",this.hasLostContext=!0),t.backstoreOnly||this._setCssDimension(r,n);return this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._setBrushStyles(),this._initRetinaScaling(),this._setImageSmoothing(),this.calcOffset(),t.cssOnly||this.requestRenderAll(),this},_setBackstoreDimension:function(e,t){return this.lowerCanvasEl[e]=t,this.upperCanvasEl&&(this.upperCanvasEl[e]=t),this.cacheCanvasEl&&(this.cacheCanvasEl[e]=t),this[e]=t,this},_setCssDimension:function(e,t){return this.lowerCanvasEl.style[e]=t,this.upperCanvasEl&&(this.upperCanvasEl.style[e]=t),this.wrapperEl&&(this.wrapperEl.style[e]=t),this},getZoom:function(){return this.viewportTransform[0]},setViewportTransform:function(e){var t,n,r,i=this._activeObject,o=!1,s=!0;for(this.viewportTransform=e,n=0,r=this._objects.length;r>n;n++)t=this._objects[n],t.group||t.setCoords(o,s);return i&&"activeSelection"===i.type&&i.setCoords(o,s),this.calcViewportBoundaries(),this.renderOnAddRemove&&this.requestRenderAll(),this},zoomToPoint:function(e,t){var n=e,o=this.viewportTransform.slice(0);e=r(e,i(this.viewportTransform)),o[0]=t,o[3]=t;var s=r(e,o);return o[4]+=n.x-s.x,o[5]+=n.y-s.y,this.setViewportTransform(o)},setZoom:function(e){return this.zoomToPoint(new fabric.Point(0,0),e),this},absolutePan:function(e){var t=this.viewportTransform.slice(0);return t[4]=-e.x,t[5]=-e.y,this.setViewportTransform(t)},relativePan:function(e){return this.absolutePan(new fabric.Point(-e.x-this.viewportTransform[4],-e.y-this.viewportTransform[5]))},getElement:function(){return this.lowerCanvasEl},_onObjectAdded:function(e){this.stateful&&e.setupState(),e._set("canvas",this),e.setCoords(),this.fire("object:added",{target:e}),e.fire("added")},_onObjectRemoved:function(e){this.fire("object:removed",{target:e}),e.fire("removed"),delete e.canvas},clearContext:function(e){return e.clearRect(0,0,this.width,this.height),this},getContext:function(){return this.contextContainer},clear:function(){return this._objects.length=0,this.backgroundImage=null,this.overlayImage=null,this.backgroundColor="",this.overlayColor="",this._hasITextHandlers&&(this.off("mouse:up",this._mouseUpITextHandler),this._iTextInstances=null,this._hasITextHandlers=!1),this.clearContext(this.contextContainer),this.fire("canvas:cleared"),this.renderOnAddRemove&&this.requestRenderAll(),this},renderAll:function(){var e=this.contextContainer;return this.renderCanvas(e,this._objects),this},renderAndReset:function(){this.isRendering=0,this.renderAll()},requestRenderAll:function(){return this.isRendering||(this.isRendering=fabric.util.requestAnimFrame(this.renderAndResetBound)),this},calcViewportBoundaries:function(){var e={},t=this.width,n=this.height,o=i(this.viewportTransform);return e.tl=r({x:0,y:0},o),e.br=r({x:t,y:n},o),e.tr=new fabric.Point(e.br.x,e.tl.y),e.bl=new fabric.Point(e.tl.x,e.br.y),this.vptCoords=e,e},renderCanvas:function(e,t){var n=this.viewportTransform;this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.calcViewportBoundaries(),this.clearContext(e),this.fire("before:render"),this.clipTo&&fabric.util.clipContext(this,e),this._renderBackground(e),e.save(),e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),this._renderObjects(e,t),e.restore(),!this.controlsAboveOverlay&&this.interactive&&this.drawControls(e),this.clipTo&&e.restore(),this._renderOverlay(e),this.controlsAboveOverlay&&this.interactive&&this.drawControls(e),this.fire("after:render")},_renderObjects:function(e,t){var n,r;for(n=0,r=t.length;r>n;++n)t[n]&&t[n].render(e)},_renderBackgroundOrOverlay:function(e,t){var n,r=this[t+"Color"];r&&(e.fillStyle=r.toLive?r.toLive(e,this):r,e.fillRect(r.offsetX||0,r.offsetY||0,this.width,this.height)),r=this[t+"Image"],r&&(this[t+"Vpt"]&&(n=this.viewportTransform,e.save(),e.transform(n[0],n[1],n[2],n[3],n[4],n[5])),r.render(e),this[t+"Vpt"]&&e.restore())},_renderBackground:function(e){this._renderBackgroundOrOverlay(e,"background")},_renderOverlay:function(e){this._renderBackgroundOrOverlay(e,"overlay")},getCenter:function(){return{top:this.height/2,left:this.width/2}},centerObjectH:function(e){return this._centerObject(e,new fabric.Point(this.getCenter().left,e.getCenterPoint().y))},centerObjectV:function(e){return this._centerObject(e,new fabric.Point(e.getCenterPoint().x,this.getCenter().top))},centerObject:function(e){var t=this.getCenter();return this._centerObject(e,new fabric.Point(t.left,t.top))},viewportCenterObject:function(e){var t=this.getVpCenter();return this._centerObject(e,t)},viewportCenterObjectH:function(e){var t=this.getVpCenter();return this._centerObject(e,new fabric.Point(t.x,e.getCenterPoint().y)),this},viewportCenterObjectV:function(e){var t=this.getVpCenter();return this._centerObject(e,new fabric.Point(e.getCenterPoint().x,t.y))},getVpCenter:function(){var e=this.getCenter(),t=i(this.viewportTransform);return r({x:e.left,y:e.top},t)},_centerObject:function(e,t){return e.setPositionByOrigin(t,"center","center"),e.setCoords(),this.renderOnAddRemove&&this.requestRenderAll(),this},toDatalessJSON:function(e){return this.toDatalessObject(e)},toObject:function(e){return this._toObjectMethod("toObject",e)},toDatalessObject:function(e){return this._toObjectMethod("toDatalessObject",e)},_toObjectMethod:function(t,n){var r={version:fabric.version,objects:this._toObjects(t,n)};return e(r,this.__serializeBgOverlay(t,n)),fabric.util.populateWithProperties(this,r,n),r},_toObjects:function(e,t){return this.getObjects().filter(function(e){return!e.excludeFromExport}).map(function(n){return this._toObject(n,e,t)},this)},_toObject:function(e,t,n){var r;this.includeDefaultValues||(r=e.includeDefaultValues,e.includeDefaultValues=!1);var i=e[t](n);return this.includeDefaultValues||(e.includeDefaultValues=r),i},__serializeBgOverlay:function(e,t){var n={},r=this.backgroundImage,i=this.overlayImage;return this.backgroundColor&&(n.background=this.backgroundColor.toObject?this.backgroundColor.toObject(t):this.backgroundColor),this.overlayColor&&(n.overlay=this.overlayColor.toObject?this.overlayColor.toObject(t):this.overlayColor),r&&!r.excludeFromExport&&(n.backgroundImage=this._toObject(r,e,t)),i&&!i.excludeFromExport&&(n.overlayImage=this._toObject(i,e,t)),n},sendToBack:function(e){if(!e)return this;var t,r,i,o=this._activeObject;if(e===o&&"activeSelection"===e.type)for(i=o._objects,t=i.length;t--;)r=i[t],n(this._objects,r),this._objects.unshift(r);else n(this._objects,e),this._objects.unshift(e);return this.renderOnAddRemove&&this.requestRenderAll(),this},bringToFront:function(e){if(!e)return this;var t,r,i,o=this._activeObject;if(e===o&&"activeSelection"===e.type)for(i=o._objects,t=0;t<i.length;t++)r=i[t],n(this._objects,r),this._objects.push(r);else n(this._objects,e),this._objects.push(e);return this.renderOnAddRemove&&this.requestRenderAll(),this},sendBackwards:function(e,t){if(!e)return this;var r,i,o,s,a,c=this._activeObject,u=0;if(e===c&&"activeSelection"===e.type)for(a=c._objects,r=0;r<a.length;r++)i=a[r],o=this._objects.indexOf(i),o>0+u&&(s=o-1,n(this._objects,i),this._objects.splice(s,0,i)),u++;else o=this._objects.indexOf(e),0!==o&&(s=this._findNewLowerIndex(e,o,t),n(this._objects,e),this._objects.splice(s,0,e));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewLowerIndex:function(e,t,n){var r,i;if(n)for(r=t,i=t-1;i>=0;--i){var o=e.intersectsWithObject(this._objects[i])||e.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(e);if(o){r=i;break}}else r=t-1;return r},bringForward:function(e,t){if(!e)return this;var r,i,o,s,a,c=this._activeObject,u=0;if(e===c&&"activeSelection"===e.type)for(a=c._objects,r=a.length;r--;)i=a[r],o=this._objects.indexOf(i),o<this._objects.length-1-u&&(s=o+1,n(this._objects,i),this._objects.splice(s,0,i)),u++;else o=this._objects.indexOf(e),o!==this._objects.length-1&&(s=this._findNewUpperIndex(e,o,t),n(this._objects,e),this._objects.splice(s,0,e));return this.renderOnAddRemove&&this.requestRenderAll(),this},_findNewUpperIndex:function(e,t,n){var r,i,o;if(n)for(r=t,i=t+1,o=this._objects.length;o>i;++i){var s=e.intersectsWithObject(this._objects[i])||e.isContainedWithinObject(this._objects[i])||this._objects[i].isContainedWithinObject(e);if(s){r=i;break}}else r=t+1;return r},moveTo:function(e,t){return n(this._objects,e),this._objects.splice(t,0,e),this.renderOnAddRemove&&this.requestRenderAll()},dispose:function(){return this.isRendering&&(fabric.util.cancelAnimFrame(this.isRendering),this.isRendering=0),this.forEachObject(function(e){e.dispose&&e.dispose()}),this._objects=[],this.backgroundImage=null,this.overlayImage=null,this._iTextInstances=null,this.lowerCanvasEl=null,this.contextContainer=null,this},toString:function(){return"#<fabric.Canvas ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"}}),e(fabric.StaticCanvas.prototype,fabric.Observable),e(fabric.StaticCanvas.prototype,fabric.Collection),e(fabric.StaticCanvas.prototype,fabric.DataURLExporter),e(fabric.StaticCanvas,{EMPTY_JSON:'{"objects": [], "background": "white"}',supports:function(e){var t=fabric.util.createCanvasElement();if(!t||!t.getContext)return null;var n=t.getContext("2d");if(!n)return null;switch(e){case"getImageData":return"undefined"!=typeof n.getImageData;case"setLineDash":return"undefined"!=typeof n.setLineDash;case"toDataURL":return"undefined"!=typeof t.toDataURL;case"toDataURLWithQuality":try{return t.toDataURL("image/jpeg",0),!0}catch(r){}return!1;default:return null}}}),fabric.StaticCanvas.prototype.toJSON=fabric.StaticCanvas.prototype.toObject,fabric.isLikelyNode&&(fabric.StaticCanvas.prototype.createPNGStream=function(){var e=fabric.util.getNodeCanvas(this.lowerCanvasEl);return e&&e.createPNGStream()},fabric.StaticCanvas.prototype.createJPEGStream=function(e){var t=fabric.util.getNodeCanvas(this.lowerCanvasEl);return t&&t.createJPEGStream(e)})}();fabric.BaseBrush=fabric.util.createClass({color:"rgb(0, 0, 0)",width:1,shadow:null,strokeLineCap:"round",strokeLineJoin:"round",strokeMiterLimit:10,strokeDashArray:null,setShadow:function(e){return this.shadow=new fabric.Shadow(e),this},_setBrushStyles:function(){var e=this.canvas.contextTop;e.strokeStyle=this.color,e.lineWidth=this.width,e.lineCap=this.strokeLineCap,e.miterLimit=this.strokeMiterLimit,e.lineJoin=this.strokeLineJoin,fabric.StaticCanvas.supports("setLineDash")&&e.setLineDash(this.strokeDashArray||[])},_saveAndTransform:function(e){var t=this.canvas.viewportTransform;e.save(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5])},_setShadow:function(){if(this.shadow){var e=this.canvas.contextTop,t=this.canvas.getZoom();e.shadowColor=this.shadow.color,e.shadowBlur=this.shadow.blur*t,e.shadowOffsetX=this.shadow.offsetX*t,e.shadowOffsetY=this.shadow.offsetY*t}},_resetShadow:function(){var e=this.canvas.contextTop;e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0}});!function(){fabric.PencilBrush=fabric.util.createClass(fabric.BaseBrush,{initialize:function(t){this.canvas=t,this._points=[]},_drawSegment:function(t,e,i){var n=e.midPointFrom(i);return t.quadraticCurveTo(e.x,e.y,n.x,n.y),n},onMouseDown:function(t){this._prepareForDrawing(t),this._captureDrawingPath(t),this._render()},onMouseMove:function(t){if(this._captureDrawingPath(t)&&this._points.length>1)if(this.needsFullRender)this.canvas.clearContext(this.canvas.contextTop),this._render();else{var e=this._points,i=e.length,n=this.canvas.contextTop;this._saveAndTransform(n),this.oldEnd&&(n.beginPath(),n.moveTo(this.oldEnd.x,this.oldEnd.y)),this.oldEnd=this._drawSegment(n,e[i-2],e[i-1],!0),n.stroke(),n.restore()}},onMouseUp:function(){this.oldEnd=void 0,this._finalizeAndAddPath()},_prepareForDrawing:function(t){var e=new fabric.Point(t.x,t.y);this._reset(),this._addPoint(e),this.canvas.contextTop.moveTo(e.x,e.y)},_addPoint:function(t){return this._points.length>1&&t.eq(this._points[this._points.length-1])?!1:(this._points.push(t),!0)},_reset:function(){this._points.length=0,this._setBrushStyles();var t=new fabric.Color(this.color);this.needsFullRender=t.getAlpha()<1,this._setShadow()},_captureDrawingPath:function(t){var e=new fabric.Point(t.x,t.y);return this._addPoint(e)},_render:function(){var t,e,i=this.canvas.contextTop,n=this._points[0],r=this._points[1];if(this._saveAndTransform(i),i.beginPath(),2===this._points.length&&n.x===r.x&&n.y===r.y){var s=this.width/1e3;n=new fabric.Point(n.x,n.y),r=new fabric.Point(r.x,r.y),n.x-=s,r.x+=s}for(i.moveTo(n.x,n.y),t=1,e=this._points.length;e>t;t++)this._drawSegment(i,n,r),n=this._points[t],r=this._points[t+1];i.lineTo(n.x,n.y),i.stroke(),i.restore()},convertPointsToSVGPath:function(t){var e,i=[],n=this.width/1e3,r=new fabric.Point(t[0].x,t[0].y),s=new fabric.Point(t[1].x,t[1].y),o=t.length,a=1,c=1,h=o>2;for(h&&(a=t[2].x<s.x?-1:t[2].x===s.x?0:1,c=t[2].y<s.y?-1:t[2].y===s.y?0:1),i.push("M ",r.x-a*n," ",r.y-c*n," "),e=1;o>e;e++){if(!r.eq(s)){var l=r.midPointFrom(s);i.push("Q ",r.x," ",r.y," ",l.x," ",l.y," ")}r=t[e],e+1<t.length&&(s=t[e+1])}return h&&(a=r.x>t[e-2].x?1:r.x===t[e-2].x?0:-1,c=r.y>t[e-2].y?1:r.y===t[e-2].y?0:-1),i.push("L ",r.x+a*n," ",r.y+c*n),i},createPath:function(t){var e=new fabric.Path(t,{fill:null,stroke:this.color,strokeWidth:this.width,strokeLineCap:this.strokeLineCap,strokeMiterLimit:this.strokeMiterLimit,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDashArray}),i=new fabric.Point(e.left+e.width/2,e.top+e.height/2);return i=e.translateToGivenOrigin(i,"center","center",e.originX,e.originY),e.top=i.y,e.left=i.x,this.shadow&&(this.shadow.affectStroke=!0,e.setShadow(this.shadow)),e},_finalizeAndAddPath:function(){var t=this.canvas.contextTop;t.closePath();var e=this.convertPointsToSVGPath(this._points).join("");if("M 0 0 Q 0 0 0 0 L 0 0"===e)return void this.canvas.requestRenderAll();var i=this.createPath(e);this.canvas.clearContext(this.canvas.contextTop),this.canvas.add(i),this.canvas.renderAll(),i.setCoords(),this._resetShadow(),this.canvas.fire("path:created",{path:i})}})}();fabric.CircleBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,initialize:function(t){this.canvas=t,this.points=[]},drawDot:function(t){var e=this.addPoint(t),i=this.canvas.contextTop;this._saveAndTransform(i),i.fillStyle=e.fill,i.beginPath(),i.arc(e.x,e.y,e.radius,0,2*Math.PI,!1),i.closePath(),i.fill(),i.restore()},onMouseDown:function(t){this.points.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.drawDot(t)},_render:function(){var t,e,i,n=this.canvas.contextTop,r=this.points;for(this._saveAndTransform(n),t=0,e=r.length;e>t;t++)i=r[t],n.fillStyle=i.fill,n.beginPath(),n.arc(i.x,i.y,i.radius,0,2*Math.PI,!1),n.closePath(),n.fill();n.restore()},onMouseMove:function(t){this.drawDot(t)},onMouseUp:function(){var t,e,i=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;var n=[];for(t=0,e=this.points.length;e>t;t++){var r=this.points[t],s=new fabric.Circle({radius:r.radius,left:r.x,top:r.y,originX:"center",originY:"center",fill:r.fill});this.shadow&&s.setShadow(this.shadow),n.push(s)}var o=new fabric.Group(n,{originX:"center",originY:"center"});o.canvas=this.canvas,this.canvas.add(o),this.canvas.fire("path:created",{path:o}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=i,this.canvas.requestRenderAll()},addPoint:function(t){var e=new fabric.Point(t.x,t.y),i=fabric.util.getRandomInt(Math.max(0,this.width-20),this.width+20)/2,n=new fabric.Color(this.color).setAlpha(fabric.util.getRandomInt(0,100)/100).toRgba();return e.radius=i,e.fill=n,this.points.push(e),e}});fabric.SprayBrush=fabric.util.createClass(fabric.BaseBrush,{width:10,density:20,dotWidth:1,dotWidthVariance:1,randomOpacity:!1,optimizeOverlapping:!0,initialize:function(t){this.canvas=t,this.sprayChunks=[]},onMouseDown:function(t){this.sprayChunks.length=0,this.canvas.clearContext(this.canvas.contextTop),this._setShadow(),this.addSprayChunk(t),this.render(this.sprayChunkPoints)},onMouseMove:function(t){this.addSprayChunk(t),this.render(this.sprayChunkPoints)},onMouseUp:function(){var t=this.canvas.renderOnAddRemove;this.canvas.renderOnAddRemove=!1;for(var e=[],i=0,n=this.sprayChunks.length;n>i;i++)for(var r=this.sprayChunks[i],s=0,o=r.length;o>s;s++){var a=new fabric.Rect({width:r[s].width,height:r[s].width,left:r[s].x+1,top:r[s].y+1,originX:"center",originY:"center",fill:this.color});e.push(a)}this.optimizeOverlapping&&(e=this._getOptimizedRects(e));var c=new fabric.Group(e,{originX:"center",originY:"center"});this.shadow&&c.setShadow(this.shadow),this.canvas.add(c),this.canvas.fire("path:created",{path:c}),this.canvas.clearContext(this.canvas.contextTop),this._resetShadow(),this.canvas.renderOnAddRemove=t,this.canvas.requestRenderAll()},_getOptimizedRects:function(t){var e,i,n,r={};for(i=0,n=t.length;n>i;i++)e=t[i].left+""+t[i].top,r[e]||(r[e]=t[i]);var s=[];for(e in r)s.push(r[e]);return s},render:function(t){var e,i,n=this.canvas.contextTop;for(n.fillStyle=this.color,this._saveAndTransform(n),e=0,i=t.length;i>e;e++){var r=t[e];"undefined"!=typeof r.opacity&&(n.globalAlpha=r.opacity),n.fillRect(r.x,r.y,r.width,r.width)}n.restore()},_render:function(){var t,e,i=this.canvas.contextTop;for(i.fillStyle=this.color,this._saveAndTransform(i),t=0,e=this.sprayChunks.length;e>t;t++)this.render(this.sprayChunks[t]);i.restore()},addSprayChunk:function(t){this.sprayChunkPoints=[];var e,i,n,r,s=this.width/2;for(r=0;r<this.density;r++){e=fabric.util.getRandomInt(t.x-s,t.x+s),i=fabric.util.getRandomInt(t.y-s,t.y+s),n=this.dotWidthVariance?fabric.util.getRandomInt(Math.max(1,this.dotWidth-this.dotWidthVariance),this.dotWidth+this.dotWidthVariance):this.dotWidth;var o=new fabric.Point(e,i);o.width=n,this.randomOpacity&&(o.opacity=fabric.util.getRandomInt(0,100)/100),this.sprayChunkPoints.push(o)}this.sprayChunks.push(this.sprayChunkPoints)}});fabric.PatternBrush=fabric.util.createClass(fabric.PencilBrush,{getPatternSrc:function(){var e=20,t=5,n=fabric.document.createElement("canvas"),r=n.getContext("2d");return n.width=n.height=e+t,r.fillStyle=this.color,r.beginPath(),r.arc(e/2,e/2,e/2,0,2*Math.PI,!1),r.closePath(),r.fill(),n},getPatternSrcFunction:function(){return String(this.getPatternSrc).replace("this.color",'"'+this.color+'"')},getPattern:function(){return this.canvas.contextTop.createPattern(this.source||this.getPatternSrc(),"repeat")},_setBrushStyles:function(){this.callSuper("_setBrushStyles"),this.canvas.contextTop.strokeStyle=this.getPattern()},createPath:function(e){var t=this.callSuper("createPath",e),n=t._getLeftTopCoords().scalarAdd(t.strokeWidth/2);return t.stroke=new fabric.Pattern({source:this.source||this.getPatternSrcFunction(),offsetX:-n.x,offsetY:-n.y}),t}});!function(){var e=fabric.util.getPointer,t=fabric.util.degreesToRadians,n=fabric.util.radiansToDegrees,r=Math.atan2,i=Math.abs,o=fabric.StaticCanvas.supports("setLineDash"),s=.5;fabric.Canvas=fabric.util.createClass(fabric.StaticCanvas,{initialize:function(e,t){t||(t={}),this.renderAndResetBound=this.renderAndReset.bind(this),this._initStatic(e,t),this._initInteractive(),this._createCacheCanvas()},uniScaleTransform:!1,uniScaleKey:"shiftKey",centeredScaling:!1,centeredRotation:!1,centeredKey:"altKey",altActionKey:"shiftKey",interactive:!0,selection:!0,selectionKey:"shiftKey",altSelectionKey:null,selectionColor:"rgba(100, 100, 255, 0.3)",selectionDashArray:[],selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,selectionFullyContained:!1,hoverCursor:"move",moveCursor:"move",defaultCursor:"default",freeDrawingCursor:"crosshair",rotationCursor:"crosshair",notAllowedCursor:"not-allowed",containerClass:"canvas-container",perPixelTargetFind:!1,targetFindTolerance:0,skipTargetFind:!1,isDrawingMode:!1,preserveObjectStacking:!1,snapAngle:0,snapThreshold:null,stopContextMenu:!1,fireRightClick:!1,fireMiddleClick:!1,_initInteractive:function(){this._currentTransform=null,this._groupSelector=null,this._initWrapperElement(),this._createUpperCanvas(),this._initEventListeners(),this._initRetinaScaling(),this.freeDrawingBrush=fabric.PencilBrush&&new fabric.PencilBrush(this),this.calcOffset()},_chooseObjectsToRender:function(){var e,t,n,r=this.getActiveObjects();if(r.length>0&&!this.preserveObjectStacking){t=[],n=[];for(var i=0,o=this._objects.length;o>i;i++)e=this._objects[i],-1===r.indexOf(e)?t.push(e):n.push(e);r.length>1&&(this._activeObject._objects=n),t.push.apply(t,n)}else t=this._objects;return t},renderAll:function(){!this.contextTopDirty||this._groupSelector||this.isDrawingMode||(this.clearContext(this.contextTop),this.contextTopDirty=!1),this.hasLostContext&&this.renderTopLayer(this.contextTop);var e=this.contextContainer;return this.renderCanvas(e,this._chooseObjectsToRender()),this},renderTopLayer:function(e){this.isDrawingMode&&this._isCurrentlyDrawing&&this.freeDrawingBrush&&this.freeDrawingBrush._render(),this.selection&&this._groupSelector&&this._drawSelection(e)},renderTop:function(){var e=this.contextTop;return this.clearContext(e),this.renderTopLayer(e),this.fire("after:render"),this.contextTopDirty=!0,this},_resetCurrentTransform:function(){var e=this._currentTransform;e.target.set({scaleX:e.original.scaleX,scaleY:e.original.scaleY,skewX:e.original.skewX,skewY:e.original.skewY,left:e.original.left,top:e.original.top}),this._shouldCenterTransform(e.target)?("center"!==e.originX&&(e.mouseXSign="right"===e.originX?-1:1),"center"!==e.originY&&(e.mouseYSign="bottom"===e.originY?-1:1),e.originX="center",e.originY="center"):(e.originX=e.original.originX,e.originY=e.original.originY)},containsPoint:function(e,t,n){var r,i=!0,o=n||this.getPointer(e,i);return r=t.group&&t.group===this._activeObject&&"activeSelection"===t.group.type?this._normalizePointer(t.group,o):{x:o.x,y:o.y},t.containsPoint(r)||t._findTargetCorner(o)},_normalizePointer:function(e,t){var n=e.calcTransformMatrix(),r=fabric.util.invertTransform(n),i=this.restorePointerVpt(t);return fabric.util.transformPoint(i,r)},isTargetTransparent:function(e,t,n){if(e.shouldCache()&&e._cacheCanvas){var r=this._normalizePointer(e,{x:t,y:n}),i=e.cacheTranslationX+r.x*e.zoomX,o=e.cacheTranslationY+r.y*e.zoomY,s=fabric.util.isTransparent(e._cacheContext,i,o,this.targetFindTolerance);return s}var a=this.contextCache,c=e.selectionBackgroundColor,u=this.viewportTransform;e.selectionBackgroundColor="",this.clearContext(a),a.save(),a.transform(u[0],u[1],u[2],u[3],u[4],u[5]),e.render(a),a.restore(),e===this._activeObject&&e._renderControls(a,{hasBorders:!1,transparentCorners:!1},{hasBorders:!1}),e.selectionBackgroundColor=c;var s=fabric.util.isTransparent(a,t,n,this.targetFindTolerance);return s},_isSelectionKeyPressed:function(e){var t=!1;return t="[object Array]"===Object.prototype.toString.call(this.selectionKey)?!!this.selectionKey.find(function(t){return e[t]===!0}):e[this.selectionKey]},_shouldClearSelection:function(e,t){var n=this.getActiveObjects(),r=this._activeObject;return!t||t&&r&&n.length>1&&-1===n.indexOf(t)&&r!==t&&!this._isSelectionKeyPressed(e)||t&&!t.evented||t&&!t.selectable&&r&&r!==t},_shouldCenterTransform:function(e){if(e){var t,n=this._currentTransform;return"scale"===n.action||"scaleX"===n.action||"scaleY"===n.action?t=this.centeredScaling||e.centeredScaling:"rotate"===n.action&&(t=this.centeredRotation||e.centeredRotation),t?!n.altKey:n.altKey}},_getOriginFromCorner:function(e,t){var n={x:e.originX,y:e.originY};return"ml"===t||"tl"===t||"bl"===t?n.x="right":("mr"===t||"tr"===t||"br"===t)&&(n.x="left"),"tl"===t||"mt"===t||"tr"===t?n.y="bottom":("bl"===t||"mb"===t||"br"===t)&&(n.y="top"),n},_getActionFromCorner:function(e,t,n){if(!t)return"drag";switch(t){case"mtr":return"rotate";case"ml":case"mr":return n[this.altActionKey]?"skewY":"scaleX";case"mt":case"mb":return n[this.altActionKey]?"skewX":"scaleY";default:return"scale"}},_setupCurrentTransform:function(e,n){if(n){var r=this.getPointer(e),i=n._findTargetCorner(this.getPointer(e,!0)),o=this._getActionFromCorner(n,i,e),s=this._getOriginFromCorner(n,i);this._currentTransform={target:n,action:o,corner:i,scaleX:n.scaleX,scaleY:n.scaleY,skewX:n.skewX,skewY:n.skewY,offsetX:r.x-n.left,offsetY:r.y-n.top,originX:s.x,originY:s.y,ex:r.x,ey:r.y,lastX:r.x,lastY:r.y,theta:t(n.angle),width:n.width*n.scaleX,mouseXSign:1,mouseYSign:1,shiftKey:e.shiftKey,altKey:e[this.centeredKey]},this._currentTransform.original={left:n.left,top:n.top,scaleX:n.scaleX,scaleY:n.scaleY,skewX:n.skewX,skewY:n.skewY,originX:s.x,originY:s.y},this._resetCurrentTransform(),this._beforeTransform(e)}},_translateObject:function(e,t){var n=this._currentTransform,r=n.target,i=e-n.offsetX,o=t-n.offsetY,s=!r.get("lockMovementX")&&r.left!==i,a=!r.get("lockMovementY")&&r.top!==o;return s&&r.set("left",i),a&&r.set("top",o),s||a},_changeSkewTransformOrigin:function(e,t,n){var r="originX",i={0:"center"},o=t.target.skewX,s="left",a="right",c="mt"===t.corner||"ml"===t.corner?1:-1,u=1;e=e>0?1:-1,"y"===n&&(o=t.target.skewY,s="top",a="bottom",r="originY"),i[-1]=s,i[1]=a,t.target.flipX&&(u*=-1),t.target.flipY&&(u*=-1),0===o?(t.skewSign=-c*e*u,t[r]=i[-e]):(o=o>0?1:-1,t.skewSign=o,t[r]=i[o*c*u])},_skewObject:function(e,t,n){var r=this._currentTransform,i=r.target,o=!1,s=i.get("lockSkewingX"),a=i.get("lockSkewingY");if(s&&"x"===n||a&&"y"===n)return!1;var c,u,l=i.getCenterPoint(),f=i.toLocalPoint(new fabric.Point(e,t),"center","center")[n],d=i.toLocalPoint(new fabric.Point(r.lastX,r.lastY),"center","center")[n],v=i._getTransformedDimensions();return this._changeSkewTransformOrigin(f-d,r,n),c=i.toLocalPoint(new fabric.Point(e,t),r.originX,r.originY)[n],u=i.translateToOriginPoint(l,r.originX,r.originY),o=this._setObjectSkew(c,r,n,v),r.lastX=e,r.lastY=t,i.setPositionByOrigin(u,r.originX,r.originY),o},_setObjectSkew:function(e,t,n,r){var i,o,s,a,c,u,l,f,d,v=t.target,p=!1,h=t.skewSign;return"x"===n?(a="y",c="Y",u="X",f=0,d=v.skewY):(a="x",c="X",u="Y",f=v.skewX,d=0),s=v._getTransformedDimensions(f,d),l=2*Math.abs(e)-s[n],2>=l?i=0:(i=h*Math.atan(l/v["scale"+u]/(s[a]/v["scale"+c])),i=fabric.util.radiansToDegrees(i)),p=v["skew"+u]!==i,v.set("skew"+u,i),0!==v["skew"+c]&&(o=v._getTransformedDimensions(),i=r[a]/o[a]*v["scale"+c],v.set("scale"+c,i)),p},_scaleObject:function(e,t,n){var r=this._currentTransform,i=r.target,o=i.lockScalingX,s=i.lockScalingY,a=i.lockScalingFlip;if(o&&s)return!1;var c=i.translateToOriginPoint(i.getCenterPoint(),r.originX,r.originY),u=i.toLocalPoint(new fabric.Point(e,t),r.originX,r.originY),l=i._getTransformedDimensions(),f=!1;return this._setLocalMouse(u,r),f=this._setObjectScale(u,r,o,s,n,a,l),i.setPositionByOrigin(c,r.originX,r.originY),f},_setObjectScale:function(e,t,n,r,i,o,s){var a,c,u,l,f=t.target,d=!1,v=!1,p=!1;return u=e.x*f.scaleX/s.x,l=e.y*f.scaleY/s.y,a=f.scaleX!==u,c=f.scaleY!==l,o&&0>=u&&u<f.scaleX&&(d=!0,e.x=0),o&&0>=l&&l<f.scaleY&&(v=!0,e.y=0),"equally"!==i||n||r?i?"x"!==i||f.get("lockUniScaling")?"y"!==i||f.get("lockUniScaling")||v||r||f.set("scaleY",l)&&(p=p||c):d||n||f.set("scaleX",u)&&(p=p||a):(d||n||f.set("scaleX",u)&&(p=p||a),v||r||f.set("scaleY",l)&&(p=p||c)):p=this._scaleObjectEqually(e,f,t,s),t.newScaleX=u,t.newScaleY=l,d||v||this._flipObject(t,i),p},_scaleObjectEqually:function(e,t,n,r){var i,o=e.y+e.x,s=r.y*n.original.scaleY/t.scaleY+r.x*n.original.scaleX/t.scaleX,a=e.x<0?-1:1,c=e.y<0?-1:1;return n.newScaleX=a*Math.abs(n.original.scaleX*o/s),n.newScaleY=c*Math.abs(n.original.scaleY*o/s),i=n.newScaleX!==t.scaleX||n.newScaleY!==t.scaleY,t.set("scaleX",n.newScaleX),t.set("scaleY",n.newScaleY),i},_flipObject:function(e,t){e.newScaleX<0&&"y"!==t&&("left"===e.originX?e.originX="right":"right"===e.originX&&(e.originX="left")),e.newScaleY<0&&"x"!==t&&("top"===e.originY?e.originY="bottom":"bottom"===e.originY&&(e.originY="top"))},_setLocalMouse:function(e,t){var n=t.target,r=this.getZoom(),o=n.padding/r;"right"===t.originX?e.x*=-1:"center"===t.originX&&(e.x*=2*t.mouseXSign,e.x<0&&(t.mouseXSign=-t.mouseXSign)),"bottom"===t.originY?e.y*=-1:"center"===t.originY&&(e.y*=2*t.mouseYSign,e.y<0&&(t.mouseYSign=-t.mouseYSign)),i(e.x)>o?e.x<0?e.x+=o:e.x-=o:e.x=0,i(e.y)>o?e.y<0?e.y+=o:e.y-=o:e.y=0},_rotateObject:function(e,t){var i,o=this._currentTransform,s=o.target,i=s.translateToOriginPoint(s.getCenterPoint(),o.originX,o.originY);if(s.lockRotation)return!1;var a=r(o.ey-i.y,o.ex-i.x),c=r(t-i.y,e-i.x),u=n(c-a+o.theta),l=!0;if(s.snapAngle>0){var f=s.snapAngle,d=s.snapThreshold||f,v=Math.ceil(u/f)*f,p=Math.floor(u/f)*f;Math.abs(u-p)<d?u=p:Math.abs(u-v)<d&&(u=v)}return 0>u&&(u=360+u),u%=360,s.angle===u?l=!1:(s.angle=u,s.setPositionByOrigin(i,o.originX,o.originY)),l},setCursor:function(e){this.upperCanvasEl.style.cursor=e},_resetObjectTransform:function(e){e.scaleX=1,e.scaleY=1,e.skewX=0,e.skewY=0,e.rotate(0)},_drawSelection:function(e){var t=this._groupSelector,n=t.left,r=t.top,a=i(n),c=i(r);if(this.selectionColor&&(e.fillStyle=this.selectionColor,e.fillRect(t.ex-(n>0?0:-n),t.ey-(r>0?0:-r),a,c)),this.selectionLineWidth&&this.selectionBorderColor)if(e.lineWidth=this.selectionLineWidth,e.strokeStyle=this.selectionBorderColor,this.selectionDashArray.length>1&&!o){var u=t.ex+s-(n>0?0:a),l=t.ey+s-(r>0?0:c);e.beginPath(),fabric.util.drawDashedLine(e,u,l,u+a,l,this.selectionDashArray),fabric.util.drawDashedLine(e,u,l+c-1,u+a,l+c-1,this.selectionDashArray),fabric.util.drawDashedLine(e,u,l,u,l+c,this.selectionDashArray),fabric.util.drawDashedLine(e,u+a-1,l,u+a-1,l+c,this.selectionDashArray),e.closePath(),e.stroke()}else fabric.Object.prototype._setLineDash.call(this,e,this.selectionDashArray),e.strokeRect(t.ex+s-(n>0?0:a),t.ey+s-(r>0?0:c),a,c)},findTarget:function(e,t){if(!this.skipTargetFind){var n,r,i=!0,o=this.getPointer(e,i),s=this._activeObject,a=this.getActiveObjects();if(this.targets=[],a.length>1&&!t&&s===this._searchPossibleTargets([s],o))return s;if(1===a.length&&s._findTargetCorner(o))return s;if(1===a.length&&s===this._searchPossibleTargets([s],o)){if(!this.preserveObjectStacking)return s;n=s,r=this.targets,this.targets=[]}var c=this._searchPossibleTargets(this._objects,o);return e[this.altSelectionKey]&&c&&n&&c!==n&&(c=n,this.targets=r),c}},_checkTarget:function(e,t){if(t&&t.visible&&t.evented&&this.containsPoint(null,t,e)){if(!this.perPixelTargetFind&&!t.perPixelTargetFind||t.isEditing)return!0;var n=this.isTargetTransparent(t,e.x,e.y);if(!n)return!0}},_searchPossibleTargets:function(e,t){for(var n,r,i,o=e.length;o--;)if(this._checkTarget(t,e[o])){n=e[o],n.subTargetCheck&&n instanceof fabric.Group&&(r=this._normalizePointer(n,t),i=this._searchPossibleTargets(n._objects,r),i&&this.targets.push(i));break}return n},restorePointerVpt:function(e){return fabric.util.transformPoint(e,fabric.util.invertTransform(this.viewportTransform))},getPointer:function(t,n){if(this._absolutePointer&&!n)return this._absolutePointer;if(this._pointer&&n)return this._pointer;var r,i=e(t),o=this.upperCanvasEl,s=o.getBoundingClientRect(),a=s.width||0,c=s.height||0;return a&&c||("top"in s&&"bottom"in s&&(c=Math.abs(s.top-s.bottom)),"right"in s&&"left"in s&&(a=Math.abs(s.right-s.left))),this.calcOffset(),i.x=i.x-this._offset.left,i.y=i.y-this._offset.top,n||(i=this.restorePointerVpt(i)),r=0===a||0===c?{width:1,height:1}:{width:o.width/a,height:o.height/c},{x:i.x*r.width,y:i.y*r.height}},_createUpperCanvas:function(){var e=this.lowerCanvasEl.className.replace(/\s*lower-canvas\s*/,"");this.upperCanvasEl?this.upperCanvasEl.className="":this.upperCanvasEl=this._createCanvasElement(),fabric.util.addClass(this.upperCanvasEl,"upper-canvas "+e),this.wrapperEl.appendChild(this.upperCanvasEl),this._copyCanvasStyle(this.lowerCanvasEl,this.upperCanvasEl),this._applyCanvasStyle(this.upperCanvasEl),this.contextTop=this.upperCanvasEl.getContext("2d")},_createCacheCanvas:function(){this.cacheCanvasEl=this._createCanvasElement(),this.cacheCanvasEl.setAttribute("width",this.width),this.cacheCanvasEl.setAttribute("height",this.height),this.contextCache=this.cacheCanvasEl.getContext("2d")},_initWrapperElement:function(){this.wrapperEl=fabric.util.wrapElement(this.lowerCanvasEl,"div",{"class":this.containerClass}),fabric.util.setStyle(this.wrapperEl,{width:this.width+"px",height:this.height+"px",position:"relative"}),fabric.util.makeElementUnselectable(this.wrapperEl)},_applyCanvasStyle:function(e){var t=this.width||e.width,n=this.height||e.height;fabric.util.setStyle(e,{position:"absolute",width:t+"px",height:n+"px",left:0,top:0,"touch-action":this.allowTouchScrolling?"manipulation":"none"}),e.width=t,e.height=n,fabric.util.makeElementUnselectable(e)},_copyCanvasStyle:function(e,t){t.style.cssText=e.style.cssText},getSelectionContext:function(){return this.contextTop},getSelectionElement:function(){return this.upperCanvasEl},getActiveObject:function(){return this._activeObject},getActiveObjects:function(){var e=this._activeObject;return e?"activeSelection"===e.type&&e._objects?e._objects.slice(0):[e]:[]},_onObjectRemoved:function(e){e===this._activeObject&&(this.fire("before:selection:cleared",{target:e}),this._discardActiveObject(),this.fire("selection:cleared",{target:e}),e.fire("deselected")),this._hoveredTarget===e&&(this._hoveredTarget=null),this.callSuper("_onObjectRemoved",e)},_fireSelectionEvents:function(e,t){var n=!1,r=this.getActiveObjects(),i=[],o=[],s={e:t};e.forEach(function(e){-1===r.indexOf(e)&&(n=!0,e.fire("deselected",s),o.push(e))}),r.forEach(function(t){-1===e.indexOf(t)&&(n=!0,t.fire("selected",s),i.push(t))}),e.length>0&&r.length>0?(s.selected=i,s.deselected=o,s.updated=i[0]||o[0],s.target=this._activeObject,n&&this.fire("selection:updated",s)):r.length>0?(1===r.length&&(s.target=i[0],this.fire("object:selected",s)),s.selected=i,s.target=this._activeObject,this.fire("selection:created",s)):e.length>0&&(s.deselected=o,this.fire("selection:cleared",s))},setActiveObject:function(e,t){var n=this.getActiveObjects();return this._setActiveObject(e,t),this._fireSelectionEvents(n,t),this},_setActiveObject:function(e,t){return this._activeObject===e?!1:this._discardActiveObject(t,e)?e.onSelect({e:t})?!1:(this._activeObject=e,!0):!1},_discardActiveObject:function(e,t){var n=this._activeObject;if(n){if(n.onDeselect({e:e,object:t}))return!1;this._activeObject=null}return!0},discardActiveObject:function(e){var t=this.getActiveObjects();return t.length&&this.fire("before:selection:cleared",{target:t[0],e:e}),this._discardActiveObject(e),this._fireSelectionEvents(t,e),this},dispose:function(){var e=this.wrapperEl;return this.removeListeners(),e.removeChild(this.upperCanvasEl),e.removeChild(this.lowerCanvasEl),this.upperCanvasEl=null,this.cacheCanvasEl=null,this.contextCache=null,this.contextTop=null,e.parentNode&&e.parentNode.replaceChild(this.lowerCanvasEl,this.wrapperEl),delete this.wrapperEl,fabric.StaticCanvas.prototype.dispose.call(this),this},clear:function(){return this.discardActiveObject(),this.clearContext(this.contextTop),this.callSuper("clear")},drawControls:function(e){var t=this._activeObject;t&&t._renderControls(e)},_toObject:function(e,t,n){var r=this._realizeGroupTransformOnObject(e),i=this.callSuper("_toObject",e,t,n);return this._unwindGroupTransformOnObject(e,r),i},_realizeGroupTransformOnObject:function(e){if(e.group&&"activeSelection"===e.group.type&&this._activeObject===e.group){var t=["angle","flipX","flipY","left","scaleX","scaleY","skewX","skewY","top"],n={};return t.forEach(function(t){n[t]=e[t]}),this._activeObject.realizeTransform(e),n}return null},_unwindGroupTransformOnObject:function(e,t){t&&e.set(t)},_setSVGObject:function(e,t,n){var r=this._realizeGroupTransformOnObject(t);this.callSuper("_setSVGObject",e,t,n),this._unwindGroupTransformOnObject(t,r)}});for(var a in fabric.StaticCanvas)"prototype"!==a&&(fabric.Canvas[a]=fabric.StaticCanvas[a]);fabric.isTouchSupported&&(fabric.Canvas.prototype._setCursorFromEvent=function(){})}();!function(){function e(e,t){return"which"in e?e.which===t:e.button===t-1}var t={mt:0,tr:1,mr:2,br:3,mb:4,bl:5,ml:6,tl:7},n=fabric.util.addListener,r=fabric.util.removeListener,i=3,o=2,s=1,a={passive:!1};fabric.util.object.extend(fabric.Canvas.prototype,{cursorMap:["n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize","nw-resize"],_initEventListeners:function(){this.removeListeners(),this._bindEvents(),this.addOrRemove(n,"add")},addOrRemove:function(e,t){e(fabric.window,"resize",this._onResize),e(this.upperCanvasEl,"mousedown",this._onMouseDown),e(this.upperCanvasEl,"mousemove",this._onMouseMove,a),e(this.upperCanvasEl,"mouseout",this._onMouseOut),e(this.upperCanvasEl,"mouseenter",this._onMouseEnter),e(this.upperCanvasEl,"wheel",this._onMouseWheel),e(this.upperCanvasEl,"contextmenu",this._onContextMenu),e(this.upperCanvasEl,"dblclick",this._onDoubleClick),e(this.upperCanvasEl,"touchstart",this._onMouseDown,a),e(this.upperCanvasEl,"touchmove",this._onMouseMove,a),e(this.upperCanvasEl,"dragover",this._onDragOver),e(this.upperCanvasEl,"dragenter",this._onDragEnter),e(this.upperCanvasEl,"dragleave",this._onDragLeave),e(this.upperCanvasEl,"drop",this._onDrop),"undefined"!=typeof eventjs&&t in eventjs&&(eventjs[t](this.upperCanvasEl,"gesture",this._onGesture),eventjs[t](this.upperCanvasEl,"drag",this._onDrag),eventjs[t](this.upperCanvasEl,"orientation",this._onOrientationChange),eventjs[t](this.upperCanvasEl,"shake",this._onShake),eventjs[t](this.upperCanvasEl,"longpress",this._onLongPress))},removeListeners:function(){this.addOrRemove(r,"remove"),r(fabric.document,"mouseup",this._onMouseUp),r(fabric.document,"touchend",this._onMouseUp,a),r(fabric.document,"mousemove",this._onMouseMove,a),r(fabric.document,"touchmove",this._onMouseMove,a)},_bindEvents:function(){this.eventsBound||(this._onMouseDown=this._onMouseDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._onMouseUp=this._onMouseUp.bind(this),this._onResize=this._onResize.bind(this),this._onGesture=this._onGesture.bind(this),this._onDrag=this._onDrag.bind(this),this._onShake=this._onShake.bind(this),this._onLongPress=this._onLongPress.bind(this),this._onOrientationChange=this._onOrientationChange.bind(this),this._onMouseWheel=this._onMouseWheel.bind(this),this._onMouseOut=this._onMouseOut.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onContextMenu=this._onContextMenu.bind(this),this._onDoubleClick=this._onDoubleClick.bind(this),this._onDragOver=this._onDragOver.bind(this),this._onDragEnter=this._simpleEventHandler.bind(this,"dragenter"),this._onDragLeave=this._simpleEventHandler.bind(this,"dragleave"),this._onDrop=this._simpleEventHandler.bind(this,"drop"),this.eventsBound=!0)},_onGesture:function(e,t){this.__onTransformGesture&&this.__onTransformGesture(e,t)},_onDrag:function(e,t){this.__onDrag&&this.__onDrag(e,t)},_onMouseWheel:function(e){this.__onMouseWheel(e)},_onMouseOut:function(e){var t=this._hoveredTarget;this.fire("mouse:out",{target:t,e:e}),this._hoveredTarget=null,t&&t.fire("mouseout",{e:e}),this._iTextInstances&&this._iTextInstances.forEach(function(e){e.isEditing&&e.hiddenTextarea.focus()})},_onMouseEnter:function(e){this.findTarget(e)||(this.fire("mouse:over",{target:null,e:e}),this._hoveredTarget=null)},_onOrientationChange:function(e,t){this.__onOrientationChange&&this.__onOrientationChange(e,t)},_onShake:function(e,t){this.__onShake&&this.__onShake(e,t)},_onLongPress:function(e,t){this.__onLongPress&&this.__onLongPress(e,t)},_onDragOver:function(e){e.preventDefault();var t=this._simpleEventHandler("dragover",e);this._fireEnterLeaveEvents(t,e)},_onContextMenu:function(e){return this.stopContextMenu&&(e.stopPropagation(),e.preventDefault()),!1},_onDoubleClick:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"dblclick"),this._resetTransformEventData(e)},_onMouseDown:function(e){this.__onMouseDown(e),this._resetTransformEventData(),n(fabric.document,"touchend",this._onMouseUp,a),n(fabric.document,"touchmove",this._onMouseMove,a),r(this.upperCanvasEl,"mousemove",this._onMouseMove,a),r(this.upperCanvasEl,"touchmove",this._onMouseMove,a),"touchstart"===e.type?r(this.upperCanvasEl,"mousedown",this._onMouseDown):(n(fabric.document,"mouseup",this._onMouseUp),n(fabric.document,"mousemove",this._onMouseMove,a))},_onMouseUp:function(e){if(this.__onMouseUp(e),this._resetTransformEventData(),r(fabric.document,"mouseup",this._onMouseUp),r(fabric.document,"touchend",this._onMouseUp,a),r(fabric.document,"mousemove",this._onMouseMove,a),r(fabric.document,"touchmove",this._onMouseMove,a),n(this.upperCanvasEl,"mousemove",this._onMouseMove,a),n(this.upperCanvasEl,"touchmove",this._onMouseMove,a),"touchend"===e.type){var t=this;setTimeout(function(){n(t.upperCanvasEl,"mousedown",t._onMouseDown)},400)}},_onMouseMove:function(e){!this.allowTouchScrolling&&e.preventDefault&&e.preventDefault(),this.__onMouseMove(e)},_onResize:function(){this.calcOffset()},_shouldRender:function(e,t){var n=this._activeObject;return n&&n.isEditing&&e===n?!1:!!(e&&(e.isMoving||e!==n)||!e&&n||!e&&!n&&!this._groupSelector||t&&this._previousPointer&&this.selection&&(t.x!==this._previousPointer.x||t.y!==this._previousPointer.y))},__onMouseUp:function(t){var n,r=this._currentTransform,a=this._groupSelector,c=!a||0===a.left&&0===a.top;if(this._cacheTransformEventData(t),n=this._target,this._handleEvent(t,"up:before"),e(t,i))return void(this.fireRightClick&&this._handleEvent(t,"up",i,c));if(e(t,o))return this.fireMiddleClick&&this._handleEvent(t,"up",o,c),void this._resetTransformEventData();if(this.isDrawingMode&&this._isCurrentlyDrawing)return void this._onMouseUpInDrawingMode(t);r&&this._finalizeCurrentTransform(t);var u=this._shouldRender(n,this._absolutePointer);(n||!c)&&this._maybeGroupObjects(t),n&&(n.isMoving=!1),this._setCursorFromEvent(t,n),this._handleEvent(t,"up",s,c),this._groupSelector=null,this._currentTransform=null,n&&(n.__corner=0),u&&this.requestRenderAll()},_simpleEventHandler:function(e,t){var n=this.findTarget(t),r=this.targets,i={e:t,target:n,subTargets:r};if(this.fire(e,i),n&&n.fire(e,i),!r)return n;for(var o=0;o<r.length;o++)r[o].fire(e,i);return n},_handleEvent:function(e,t,n,r){var i=this._target,o=this.targets||[],a={e:e,target:i,subTargets:o,button:n||s,isClick:r||!1,pointer:this._pointer,absolutePointer:this._absolutePointer,transform:this._currentTransform};this.fire("mouse:"+t,a),i&&i.fire("mouse"+t,a);for(var c=0;c<o.length;c++)o[c].fire("mouse"+t,a)},_finalizeCurrentTransform:function(e){var t,n=this._currentTransform,r=n.target,i={e:e,target:r,transform:n};r._scaling&&(r._scaling=!1),r.setCoords(),(n.actionPerformed||this.stateful&&r.hasStateChanged())&&(n.actionPerformed&&(t=this._addEventOptions(i,n),this._fire(t,i)),this._fire("modified",i))},_addEventOptions:function(e,t){var n,r;switch(t.action){case"scaleX":n="scaled",r="x";break;case"scaleY":n="scaled",r="y";break;case"skewX":n="skewed",r="x";break;case"skewY":n="skewed",r="y";break;case"scale":n="scaled",r="equally";break;case"rotate":n="rotated";break;case"drag":n="moved"}return e.by=r,n},_onMouseDownInDrawingMode:function(e){this._isCurrentlyDrawing=!0,this.getActiveObject()&&this.discardActiveObject(e).requestRenderAll(),this.clipTo&&fabric.util.clipContext(this,this.contextTop);var t=this.getPointer(e);this.freeDrawingBrush.onMouseDown(t),this._handleEvent(e,"down")},_onMouseMoveInDrawingMode:function(e){if(this._isCurrentlyDrawing){var t=this.getPointer(e);this.freeDrawingBrush.onMouseMove(t)}this.setCursor(this.freeDrawingCursor),this._handleEvent(e,"move")},_onMouseUpInDrawingMode:function(e){this._isCurrentlyDrawing=!1,this.clipTo&&this.contextTop.restore(),this.freeDrawingBrush.onMouseUp(),this._handleEvent(e,"up")},__onMouseDown:function(t){this._cacheTransformEventData(t),this._handleEvent(t,"down:before");var n=this._target;if(e(t,i))return void(this.fireRightClick&&this._handleEvent(t,"down",i));if(e(t,o))return void(this.fireMiddleClick&&this._handleEvent(t,"down",o));if(this.isDrawingMode)return void this._onMouseDownInDrawingMode(t);if(!this._currentTransform){var r=this._pointer;this._previousPointer=r;var s=this._shouldRender(n,r),a=this._shouldGroup(t,n);this._shouldClearSelection(t,n)?this.discardActiveObject(t):a&&(this._handleGrouping(t,n),n=this._activeObject),!this.selection||n&&(n.selectable||n.isEditing||n===this._activeObject)||(this._groupSelector={ex:r.x,ey:r.y,top:0,left:0}),n&&(n.selectable&&this.setActiveObject(n,t),n!==this._activeObject||!n.__corner&&a||this._setupCurrentTransform(t,n)),this._handleEvent(t,"down"),s&&this.requestRenderAll()}},_resetTransformEventData:function(){this._target=null,this._pointer=null,this._absolutePointer=null},_cacheTransformEventData:function(e){this._resetTransformEventData(),this._pointer=this.getPointer(e,!0),this._absolutePointer=this.restorePointerVpt(this._pointer),this._target=this._currentTransform?this._currentTransform.target:this.findTarget(e)||null},_beforeTransform:function(e){var t=this._currentTransform;this.stateful&&t.target.saveState(),this.fire("before:transform",{e:e,transform:t}),t.corner&&this.onBeforeScaleRotate(t.target)},__onMouseMove:function(e){this._handleEvent(e,"move:before"),this._cacheTransformEventData(e);var t,n;if(this.isDrawingMode)return void this._onMouseMoveInDrawingMode(e);if(!("undefined"!=typeof e.touches&&e.touches.length>1)){var r=this._groupSelector;r?(n=this._pointer,r.left=n.x-r.ex,r.top=n.y-r.ey,this.renderTop()):this._currentTransform?this._transformObject(e):(t=this.findTarget(e)||null,this._setCursorFromEvent(e,t),this._fireOverOutEvents(t,e)),this._handleEvent(e,"move"),this._resetTransformEventData()}},_fireOverOutEvents:function(e,t){this.fireSynteticInOutEvents(e,t,{targetName:"_hoveredTarget",canvasEvtOut:"mouse:out",evtOut:"mouseout",canvasEvtIn:"mouse:over",evtIn:"mouseover"})},_fireEnterLeaveEvents:function(e,t){this.fireSynteticInOutEvents(e,t,{targetName:"_draggedoverTarget",evtOut:"dragleave",evtIn:"dragenter"})},fireSynteticInOutEvents:function(e,t,n){var r,i,o,s,a=this[n.targetName],c=a!==e,u=n.canvasEvtIn,l=n.canvasEvtOut;c&&(r={e:t,target:e,previousTarget:a},i={e:t,target:a,nextTarget:e},this[n.targetName]=e),s=e&&c,o=a&&c,o&&(l&&this.fire(l,i),a.fire(n.evtOut,i)),s&&(u&&this.fire(u,r),e.fire(n.evtIn,r))},__onMouseWheel:function(e){this._cacheTransformEventData(e),this._handleEvent(e,"wheel"),this._resetTransformEventData()},_transformObject:function(e){var t=this.getPointer(e),n=this._currentTransform;n.reset=!1,n.target.isMoving=!0,n.shiftKey=e.shiftKey,n.altKey=e[this.centeredKey],this._beforeScaleTransform(e,n),this._performTransformAction(e,n,t),n.actionPerformed&&this.requestRenderAll()},_performTransformAction:function(e,t,n){var r=n.x,i=n.y,o=t.action,s=!1,a={target:t.target,e:e,transform:t,pointer:n};"rotate"===o?(s=this._rotateObject(r,i))&&this._fire("rotating",a):"scale"===o?(s=this._onScale(e,t,r,i))&&this._fire("scaling",a):"scaleX"===o?(s=this._scaleObject(r,i,"x"))&&this._fire("scaling",a):"scaleY"===o?(s=this._scaleObject(r,i,"y"))&&this._fire("scaling",a):"skewX"===o?(s=this._skewObject(r,i,"x"))&&this._fire("skewing",a):"skewY"===o?(s=this._skewObject(r,i,"y"))&&this._fire("skewing",a):(s=this._translateObject(r,i),s&&(this._fire("moving",a),this.setCursor(a.target.moveCursor||this.moveCursor))),t.actionPerformed=t.actionPerformed||s},_fire:function(e,t){this.fire("object:"+e,t),t.target.fire(e,t)},_beforeScaleTransform:function(e,t){if("scale"===t.action||"scaleX"===t.action||"scaleY"===t.action){var n=this._shouldCenterTransform(t.target);(n&&("center"!==t.originX||"center"!==t.originY)||!n&&"center"===t.originX&&"center"===t.originY)&&(this._resetCurrentTransform(),t.reset=!0)}},_onScale:function(e,t,n,r){return this._isUniscalePossible(e,t.target)?(t.currentAction="scale",this._scaleObject(n,r)):(t.reset||"scale"!==t.currentAction||this._resetCurrentTransform(),t.currentAction="scaleEqually",this._scaleObject(n,r,"equally"))},_isUniscalePossible:function(e,t){return(e[this.uniScaleKey]||this.uniScaleTransform)&&!t.get("lockUniScaling")},_setCursorFromEvent:function(e,t){if(!t)return this.setCursor(this.defaultCursor),!1;var n=t.hoverCursor||this.hoverCursor,r=this._activeObject&&"activeSelection"===this._activeObject.type?this._activeObject:null,i=(!r||!r.contains(t))&&t._findTargetCorner(this.getPointer(e,!0));this.setCursor(i?this.getCornerCursor(i,t,e):n)},getCornerCursor:function(e,n,r){return this.actionIsDisabled(e,n,r)?this.notAllowedCursor:e in t?this._getRotatedCornerCursor(e,n,r):"mtr"===e&&n.hasRotatingPoint?this.rotationCursor:this.defaultCursor},actionIsDisabled:function(e,t,n){return"mt"===e||"mb"===e?n[this.altActionKey]?t.lockSkewingX:t.lockScalingY:"ml"===e||"mr"===e?n[this.altActionKey]?t.lockSkewingY:t.lockScalingX:"mtr"===e?t.lockRotation:this._isUniscalePossible(n,t)?t.lockScalingX&&t.lockScalingY:t.lockScalingX||t.lockScalingY},_getRotatedCornerCursor:function(e,n,r){var i=Math.round(n.angle%360/45);return 0>i&&(i+=8),i+=t[e],r[this.altActionKey]&&t[e]%2===0&&(i+=2),i%=8,this.cursorMap[i]}})}();!function(){var e=Math.min,t=Math.max;fabric.util.object.extend(fabric.Canvas.prototype,{_shouldGroup:function(e,t){var n=this._activeObject;return n&&this._isSelectionKeyPressed(e)&&t&&t.selectable&&this.selection&&(n!==t||"activeSelection"===n.type)},_handleGrouping:function(e,t){var n=this._activeObject;n.__corner||(t!==n||(t=this.findTarget(e,!0)))&&(n&&"activeSelection"===n.type?this._updateActiveSelection(t,e):this._createActiveSelection(t,e))},_updateActiveSelection:function(e,t){var n=this._activeObject,r=n._objects.slice(0);n.contains(e)?(n.removeWithUpdate(e),this._hoveredTarget=e,1===n.size()&&this._setActiveObject(n.item(0),t)):(n.addWithUpdate(e),this._hoveredTarget=n),this._fireSelectionEvents(r,t)},_createActiveSelection:function(e,t){var n=this.getActiveObjects(),r=this._createGroup(e);this._hoveredTarget=r,this._setActiveObject(r,t),this._fireSelectionEvents(n,t)},_createGroup:function(e){var t=this.getObjects(),n=t.indexOf(this._activeObject)<t.indexOf(e),r=n?[this._activeObject,e]:[e,this._activeObject];return this._activeObject.isEditing&&this._activeObject.exitEditing(),new fabric.ActiveSelection(r,{canvas:this})},_groupSelectedObjects:function(e){var t,n=this._collectObjects();1===n.length?this.setActiveObject(n[0],e):n.length>1&&(t=new fabric.ActiveSelection(n.reverse(),{canvas:this}),this.setActiveObject(t,e))},_collectObjects:function(){for(var n,r=[],i=this._groupSelector.ex,o=this._groupSelector.ey,s=i+this._groupSelector.left,a=o+this._groupSelector.top,c=new fabric.Point(e(i,s),e(o,a)),u=new fabric.Point(t(i,s),t(o,a)),l=!this.selectionFullyContained,f=i===s&&o===a,h=this._objects.length;h--&&(n=this._objects[h],!(n&&n.selectable&&n.visible&&(l&&n.intersectsWithRect(c,u)||n.isContainedWithinRect(c,u)||l&&n.containsPoint(c)||l&&n.containsPoint(u))&&(r.push(n),f))););return r},_maybeGroupObjects:function(e){this.selection&&this._groupSelector&&this._groupSelectedObjects(e),this.setCursor(this.defaultCursor),this._groupSelector=null}})}();!function(){var e=fabric.StaticCanvas.supports("toDataURLWithQuality");fabric.util.object.extend(fabric.StaticCanvas.prototype,{toDataURL:function(e){e||(e={});var t=e.format||"png",n=e.quality||1,r=(e.multiplier||1)*(e.enableRetinaScaling?1:1/this.getRetinaScaling()),i={left:e.left||0,top:e.top||0,width:e.width||0,height:e.height||0};return this.__toDataURLWithMultiplier(t,n,i,r)},__toDataURLWithMultiplier:function(e,t,n,r){var i=this.width,o=this.height,s=(n.width||this.width)*r,a=(n.height||this.height)*r,c=this.getZoom(),u=c*r,l=this.viewportTransform,f=(l[4]-n.left)*r,h=(l[5]-n.top)*r,d=[u,0,0,u,f,h],v=this.interactive,g=this.skipOffscreen,p=i!==s||o!==a;this.viewportTransform=d,this.skipOffscreen=!1,this.interactive=!1,p&&this.setDimensions({width:s,height:a},{backstoreOnly:!0}),this.renderAll();var m=this.__toDataURL(e,t,n);return this.interactive=v,this.skipOffscreen=g,this.viewportTransform=l,p&&this.setDimensions({width:i,height:o},{backstoreOnly:!0}),this.renderAll(),m},__toDataURL:function(t,n){var r=this.contextContainer.canvas;"jpg"===t&&(t="jpeg");var i=e?r.toDataURL("image/"+t,n):r.toDataURL("image/"+t);return i}})}();!function(){var e=fabric.util.degreesToRadians,t=fabric.util.radiansToDegrees;fabric.util.object.extend(fabric.Canvas.prototype,{__onTransformGesture:function(e,t){if(!this.isDrawingMode&&e.touches&&2===e.touches.length&&"gesture"===t.gesture){var n=this.findTarget(e);"undefined"!=typeof n&&(this.__gesturesParams={e:e,self:t,target:n},this.__gesturesRenderer()),this.fire("touch:gesture",{target:n,e:e,self:t})}},__gesturesParams:null,__gesturesRenderer:function(){if(null!==this.__gesturesParams&&null!==this._currentTransform){var e=this.__gesturesParams.self,t=this._currentTransform,n=this.__gesturesParams.e;t.action="scale",t.originX=t.originY="center",this._scaleObjectBy(e.scale,n),0!==e.rotation&&(t.action="rotate",this._rotateObjectByAngle(e.rotation,n)),this.requestRenderAll(),t.action="drag"}},__onDrag:function(e,t){this.fire("touch:drag",{e:e,self:t})},__onOrientationChange:function(e,t){this.fire("touch:orientation",{e:e,self:t})},__onShake:function(e,t){this.fire("touch:shake",{e:e,self:t})},__onLongPress:function(e,t){this.fire("touch:longpress",{e:e,self:t})},_scaleObjectBy:function(e,t){var n=this._currentTransform,r=n.target,i=r.get("lockScalingX"),o=r.get("lockScalingY");if(!i||!o){r._scaling=!0;var s=r.translateToOriginPoint(r.getCenterPoint(),n.originX,n.originY),a=r._getTransformedDimensions();this._setObjectScale(new fabric.Point(n.scaleX*a.x*e/r.scaleX,n.scaleY*a.y*e/r.scaleY),n,i,o,null,r.get("lockScalingFlip"),a),r.setPositionByOrigin(s,n.originX,n.originY),this._fire("scaling",r,t)}},_rotateObjectByAngle:function(n,r){var i=this._currentTransform;i.target.get("lockRotation")||(i.target.rotate(t(e(n)+i.theta)),this._fire("rotating",i.target,r))}})}();!function(e){"use strict";var t=e.fabric||(e.fabric={}),n=t.util.object.extend,i=t.util.object.clone,r=t.util.toFixed,s=t.util.string.capitalize,o=t.util.degreesToRadians,a=t.StaticCanvas.supports("setLineDash"),c=!t.isLikelyNode,l=2;t.Object||(t.Object=t.util.createClass(t.CommonMethods,{type:"object",originX:"left",originY:"top",top:0,left:0,width:0,height:0,scaleX:1,scaleY:1,flipX:!1,flipY:!1,opacity:1,angle:0,skewX:0,skewY:0,cornerSize:13,transparentCorners:!0,hoverCursor:null,moveCursor:null,padding:0,borderColor:"rgba(102,153,255,0.75)",borderDashArray:null,cornerColor:"rgba(102,153,255,0.5)",cornerStrokeColor:null,cornerStyle:"rect",cornerDashArray:null,centeredScaling:!1,centeredRotation:!0,fill:"rgb(0,0,0)",fillRule:"nonzero",globalCompositeOperation:"source-over",backgroundColor:"",selectionBackgroundColor:"",stroke:null,strokeWidth:1,strokeDashArray:null,strokeLineCap:"butt",strokeLineJoin:"miter",strokeMiterLimit:4,shadow:null,borderOpacityWhenMoving:.4,borderScaleFactor:1,transformMatrix:null,minScaleLimit:0,selectable:!0,evented:!0,visible:!0,hasControls:!0,hasBorders:!0,hasRotatingPoint:!0,rotatingPointOffset:40,perPixelTargetFind:!1,includeDefaultValues:!0,clipTo:null,lockMovementX:!1,lockMovementY:!1,lockRotation:!1,lockScalingX:!1,lockScalingY:!1,lockUniScaling:!1,lockSkewingX:!1,lockSkewingY:!1,lockScalingFlip:!1,excludeFromExport:!1,objectCaching:c,statefullCache:!1,noScaleCache:!0,dirty:!0,__corner:0,paintFirst:"fill",stateProperties:"top left width height scaleX scaleY flipX flipY originX originY transformMatrix stroke strokeWidth strokeDashArray strokeLineCap strokeLineJoin strokeMiterLimit angle opacity fill globalCompositeOperation shadow clipTo visible backgroundColor skewX skewY fillRule paintFirst".split(" "),cacheProperties:"fill stroke strokeWidth strokeDashArray width height paintFirst strokeLineCap strokeLineJoin strokeMiterLimit backgroundColor".split(" "),initialize:function(e){e&&this.setOptions(e)},_createCacheCanvas:function(){this._cacheProperties={},this._cacheCanvas=t.document.createElement("canvas"),this._cacheContext=this._cacheCanvas.getContext("2d"),this._updateCacheCanvas(),this.dirty=!0},_limitCacheSize:function(e){var n=t.perfLimitSizeTotal,i=e.width,r=e.height,s=t.maxCacheSideLimit,o=t.minCacheSideLimit;if(s>=i&&s>=r&&n>=i*r)return o>i&&(e.width=o),o>r&&(e.height=o),e;var a=i/r,c=t.util.limitDimsByArea(a,n),l=t.util.capValue,u=l(o,c.x,s),h=l(o,c.y,s);return i>u&&(e.zoomX/=i/u,e.width=u,e.capped=!0),r>h&&(e.zoomY/=r/h,e.height=h,e.capped=!0),e},_getCacheCanvasDimensions:function(){var e=this.canvas&&this.canvas.getZoom()||1,n=this.getObjectScaling(),i=this.canvas&&this.canvas._isRetinaScaling()?t.devicePixelRatio:1,r=this._getNonTransformedDimensions(),s=n.scaleX*e*i,o=n.scaleY*e*i,a=r.x*s,c=r.y*o;return{width:a+l,height:c+l,zoomX:s,zoomY:o,x:r.x,y:r.y}},_updateCacheCanvas:function(){if(this.noScaleCache&&this.canvas&&this.canvas._currentTransform){var e=this.canvas._currentTransform.target,n=this.canvas._currentTransform.action;if(this===e&&n.slice&&"scale"===n.slice(0,5))return!1}var i,r,s=this._cacheCanvas,o=this._limitCacheSize(this._getCacheCanvasDimensions()),a=t.minCacheSideLimit,c=o.width,l=o.height,u=o.zoomX,h=o.zoomY,f=c!==this.cacheWidth||l!==this.cacheHeight,d=this.zoomX!==u||this.zoomY!==h,v=f||d,g=0,p=0,m=!1;if(f){var b=this._cacheCanvas.width,y=this._cacheCanvas.height,_=c>b||l>y,w=(.9*b>c||.9*y>l)&&b>a&&y>a;m=_||w,_&&!o.capped&&(c>a||l>a)&&(g=.1*c,p=.1*l)}return v?(m?(s.width=Math.ceil(c+g),s.height=Math.ceil(l+p)):(this._cacheContext.setTransform(1,0,0,1,0,0),this._cacheContext.clearRect(0,0,s.width,s.height)),i=o.x*u/2,r=o.y*h/2,this.cacheTranslationX=Math.round(s.width/2-i)+i,this.cacheTranslationY=Math.round(s.height/2-r)+r,this.cacheWidth=c,this.cacheHeight=l,this._cacheContext.translate(this.cacheTranslationX,this.cacheTranslationY),this._cacheContext.scale(u,h),this.zoomX=u,this.zoomY=h,!0):!1},setOptions:function(e){this._setOptions(e),this._initGradient(e.fill,"fill"),this._initGradient(e.stroke,"stroke"),this._initClipping(e),this._initPattern(e.fill,"fill"),this._initPattern(e.stroke,"stroke")},transform:function(e){var t;t=this.group&&!this.group._transformDone?this.calcTransformMatrix():this.calcOwnMatrix(),e.transform(t[0],t[1],t[2],t[3],t[4],t[5])},toObject:function(e){var n=t.Object.NUM_FRACTION_DIGITS,i={type:this.type,version:t.version,originX:this.originX,originY:this.originY,left:r(this.left,n),top:r(this.top,n),width:r(this.width,n),height:r(this.height,n),fill:this.fill&&this.fill.toObject?this.fill.toObject():this.fill,stroke:this.stroke&&this.stroke.toObject?this.stroke.toObject():this.stroke,strokeWidth:r(this.strokeWidth,n),strokeDashArray:this.strokeDashArray?this.strokeDashArray.concat():this.strokeDashArray,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeMiterLimit:r(this.strokeMiterLimit,n),scaleX:r(this.scaleX,n),scaleY:r(this.scaleY,n),angle:r(this.angle,n),flipX:this.flipX,flipY:this.flipY,opacity:r(this.opacity,n),shadow:this.shadow&&this.shadow.toObject?this.shadow.toObject():this.shadow,visible:this.visible,clipTo:this.clipTo&&String(this.clipTo),backgroundColor:this.backgroundColor,fillRule:this.fillRule,paintFirst:this.paintFirst,globalCompositeOperation:this.globalCompositeOperation,transformMatrix:this.transformMatrix?this.transformMatrix.concat():null,skewX:r(this.skewX,n),skewY:r(this.skewY,n)};return t.util.populateWithProperties(this,i,e),this.includeDefaultValues||(i=this._removeDefaultValues(i)),i},toDatalessObject:function(e){return this.toObject(e)},_removeDefaultValues:function(e){var n=t.util.getKlass(e.type).prototype,i=n.stateProperties;return i.forEach(function(t){e[t]===n[t]&&delete e[t];var i="[object Array]"===Object.prototype.toString.call(e[t])&&"[object Array]"===Object.prototype.toString.call(n[t]);i&&0===e[t].length&&0===n[t].length&&delete e[t]}),e},toString:function(){return"#<fabric."+s(this.type)+">"},getObjectScaling:function(){var e=this.scaleX,t=this.scaleY;if(this.group){var n=this.group.getObjectScaling();e*=n.scaleX,t*=n.scaleY}return{scaleX:e,scaleY:t}},getObjectOpacity:function(){var e=this.opacity;return this.group&&(e*=this.group.getObjectOpacity()),e},_set:function(e,n){var i="scaleX"===e||"scaleY"===e,r=this[e]!==n,s=!1;return i&&(n=this._constrainScale(n)),"scaleX"===e&&0>n?(this.flipX=!this.flipX,n*=-1):"scaleY"===e&&0>n?(this.flipY=!this.flipY,n*=-1):"shadow"!==e||!n||n instanceof t.Shadow?"dirty"===e&&this.group&&this.group.set("dirty",n):n=new t.Shadow(n),this[e]=n,r&&(s=this.group&&this.group.isOnACache(),this.cacheProperties.indexOf(e)>-1?(this.dirty=!0,s&&this.group.set("dirty",!0)):s&&this.stateProperties.indexOf(e)>-1&&this.group.set("dirty",!0)),this},setOnGroup:function(){},getViewportTransform:function(){return this.canvas&&this.canvas.viewportTransform?this.canvas.viewportTransform:t.iMatrix.concat()},isNotVisible:function(){return 0===this.opacity||0===this.width&&0===this.height||!this.visible},render:function(e){this.isNotVisible()||(!this.canvas||!this.canvas.skipOffscreen||this.group||this.isOnScreen())&&(e.save(),this._setupCompositeOperation(e),this.drawSelectionBackground(e),this.transform(e),this._setOpacity(e),this._setShadow(e,this),this.transformMatrix&&e.transform.apply(e,this.transformMatrix),this.clipTo&&t.util.clipContext(this,e),this.shouldCache()?(this._cacheCanvas||this._createCacheCanvas(),this.isCacheDirty()&&(this.statefullCache&&this.saveState({propertySet:"cacheProperties"}),this.drawObject(this._cacheContext),this.dirty=!1),this.drawCacheOnCanvas(e)):(this._removeCacheCanvas(),this.dirty=!1,this.drawObject(e),this.objectCaching&&this.statefullCache&&this.saveState({propertySet:"cacheProperties"})),this.clipTo&&e.restore(),e.restore())},_removeCacheCanvas:function(){this._cacheCanvas=null,this.cacheWidth=0,this.cacheHeight=0},needsItsOwnCache:function(){return"stroke"===this.paintFirst&&"object"==typeof this.shadow?!0:!1},shouldCache:function(){return this.ownCaching=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isOnACache()),this.ownCaching},willDrawShadow:function(){return!!this.shadow&&(0!==this.shadow.offsetX||0!==this.shadow.offsetY)},drawObject:function(e){this._renderBackground(e),this._setStrokeStyles(e,this),this._setFillStyles(e,this),this._render(e)},drawCacheOnCanvas:function(e){e.scale(1/this.zoomX,1/this.zoomY),e.drawImage(this._cacheCanvas,-this.cacheTranslationX,-this.cacheTranslationY)},isCacheDirty:function(e){if(this.isNotVisible())return!1;if(this._cacheCanvas&&!e&&this._updateCacheCanvas())return!0;if(this.dirty||this.statefullCache&&this.hasStateChanged("cacheProperties")){if(this._cacheCanvas&&!e){var t=this.cacheWidth/this.zoomX,n=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-t/2,-n/2,t,n)}return!0}return!1},_renderBackground:function(e){if(this.backgroundColor){var t=this._getNonTransformedDimensions();e.fillStyle=this.backgroundColor,e.fillRect(-t.x/2,-t.y/2,t.x,t.y),this._removeShadow(e)}},_setOpacity:function(e){this.group&&!this.group._transformDone?e.globalAlpha=this.getObjectOpacity():e.globalAlpha*=this.opacity},_setStrokeStyles:function(e,t){t.stroke&&(e.lineWidth=t.strokeWidth,e.lineCap=t.strokeLineCap,e.lineJoin=t.strokeLineJoin,e.miterLimit=t.strokeMiterLimit,e.strokeStyle=t.stroke.toLive?t.stroke.toLive(e,this):t.stroke)},_setFillStyles:function(e,t){t.fill&&(e.fillStyle=t.fill.toLive?t.fill.toLive(e,this):t.fill)},_setLineDash:function(e,t,n){t&&(1&t.length&&t.push.apply(t,t),a?e.setLineDash(t):n&&n(e))},_renderControls:function(e,n){var i,r,s,a=this.getViewportTransform(),c=this.calcTransformMatrix();n=n||{},r="undefined"!=typeof n.hasBorders?n.hasBorders:this.hasBorders,s="undefined"!=typeof n.hasControls?n.hasControls:this.hasControls,c=t.util.multiplyTransformMatrices(a,c),i=t.util.qrDecompose(c),e.save(),e.translate(i.translateX,i.translateY),e.lineWidth=1*this.borderScaleFactor,this.group||(e.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1),n.forActiveSelection?(e.rotate(o(i.angle)),r&&this.drawBordersInGroup(e,i,n)):(e.rotate(o(this.angle)),r&&this.drawBorders(e,n)),s&&this.drawControls(e,n),e.restore()},_setShadow:function(e){if(this.shadow){var n=this.canvas&&this.canvas.viewportTransform[0]||1,i=this.canvas&&this.canvas.viewportTransform[3]||1,r=this.getObjectScaling();this.canvas&&this.canvas._isRetinaScaling()&&(n*=t.devicePixelRatio,i*=t.devicePixelRatio),e.shadowColor=this.shadow.color,e.shadowBlur=this.shadow.blur*t.browserShadowBlurConstant*(n+i)*(r.scaleX+r.scaleY)/4,e.shadowOffsetX=this.shadow.offsetX*n*r.scaleX,e.shadowOffsetY=this.shadow.offsetY*i*r.scaleY}},_removeShadow:function(e){this.shadow&&(e.shadowColor="",e.shadowBlur=e.shadowOffsetX=e.shadowOffsetY=0)},_applyPatternGradientTransform:function(e,t){if(!t||!t.toLive)return{offsetX:0,offsetY:0};var n=t.gradientTransform||t.patternTransform,i=-this.width/2+t.offsetX||0,r=-this.height/2+t.offsetY||0;return e.translate(i,r),n&&e.transform(n[0],n[1],n[2],n[3],n[4],n[5]),{offsetX:i,offsetY:r}},_renderPaintInOrder:function(e){"stroke"===this.paintFirst?(this._renderStroke(e),this._renderFill(e)):(this._renderFill(e),this._renderStroke(e))},_renderFill:function(e){this.fill&&(e.save(),this._applyPatternGradientTransform(e,this.fill),"evenodd"===this.fillRule?e.fill("evenodd"):e.fill(),e.restore())},_renderStroke:function(e){this.stroke&&0!==this.strokeWidth&&(this.shadow&&!this.shadow.affectStroke&&this._removeShadow(e),e.save(),this._setLineDash(e,this.strokeDashArray,this._renderDashedStroke),this._applyPatternGradientTransform(e,this.stroke),e.stroke(),e.restore())},_findCenterFromElement:function(){return{x:this.left+this.width/2,y:this.top+this.height/2}},_assignTransformMatrixProps:function(){if(this.transformMatrix){var e=t.util.qrDecompose(this.transformMatrix);this.flipX=!1,this.flipY=!1,this.set("scaleX",e.scaleX),this.set("scaleY",e.scaleY),this.angle=e.angle,this.skewX=e.skewX,this.skewY=0}},_removeTransformMatrix:function(e){var n=this._findCenterFromElement();this.transformMatrix&&(this._assignTransformMatrixProps(),n=t.util.transformPoint(n,this.transformMatrix)),this.transformMatrix=null,e&&(this.scaleX*=e.scaleX,this.scaleY*=e.scaleY,this.cropX=e.cropX,this.cropY=e.cropY,n.x+=e.offsetLeft,n.y+=e.offsetTop,this.width=e.width,this.height=e.height),this.setPositionByOrigin(n,"center","center")},clone:function(e,n){var i=this.toObject(n);this.constructor.fromObject?this.constructor.fromObject(i,e):t.Object._fromObject("Object",i,e)},cloneAsImage:function(e,n){var i=this.toDataURL(n);return t.util.loadImage(i,function(n){e&&e(new t.Image(n))}),this},toDataURL:function(e){e||(e={});var n=t.util.createCanvasElement(),i=this.getBoundingRect();n.width=i.width,n.height=i.height,t.util.wrapElement(n,"div");var r=new t.StaticCanvas(n,{enableRetinaScaling:e.enableRetinaScaling,renderOnAddRemove:!1,skipOffscreen:!1});"jpg"===e.format&&(e.format="jpeg"),"jpeg"===e.format&&(r.backgroundColor="#fff");var s={left:this.left,top:this.top};this.setPositionByOrigin(new t.Point(r.width/2,r.height/2),"center","center");var o=this.canvas;r.add(this);var a=r.toDataURL(e);return this.set(s).setCoords(),this.canvas=o,r._objects=[],r.dispose(),r=null,a},isType:function(e){return this.type===e},complexity:function(){return 1},toJSON:function(e){return this.toObject(e)},setGradient:function(e,n){n||(n={});var i={colorStops:[]};return i.type=n.type||(n.r1||n.r2?"radial":"linear"),i.coords={x1:n.x1,y1:n.y1,x2:n.x2,y2:n.y2},(n.r1||n.r2)&&(i.coords.r1=n.r1,i.coords.r2=n.r2),i.gradientTransform=n.gradientTransform,t.Gradient.prototype.addColorStop.call(i,n.colorStops),this.set(e,t.Gradient.forObject(this,i))},setPatternFill:function(e){return this.set("fill",new t.Pattern(e))},setShadow:function(e){return this.set("shadow",e?new t.Shadow(e):null)},setColor:function(e){return this.set("fill",e),this},rotate:function(e){var t=("center"!==this.originX||"center"!==this.originY)&&this.centeredRotation;return t&&this._setOriginToCenter(),this.set("angle",e),t&&this._resetOrigin(),this},centerH:function(){return this.canvas&&this.canvas.centerObjectH(this),this},viewportCenterH:function(){return this.canvas&&this.canvas.viewportCenterObjectH(this),this},centerV:function(){return this.canvas&&this.canvas.centerObjectV(this),this},viewportCenterV:function(){return this.canvas&&this.canvas.viewportCenterObjectV(this),this},center:function(){return this.canvas&&this.canvas.centerObject(this),this},viewportCenter:function(){return this.canvas&&this.canvas.viewportCenterObject(this),this},getLocalPointer:function(e,n){n=n||this.canvas.getPointer(e);var i=new t.Point(n.x,n.y),r=this._getLeftTopCoords();return this.angle&&(i=t.util.rotatePoint(i,r,o(-this.angle))),{x:i.x-r.x,y:i.y-r.y}},_setupCompositeOperation:function(e){this.globalCompositeOperation&&(e.globalCompositeOperation=this.globalCompositeOperation)}}),t.util.createAccessors&&t.util.createAccessors(t.Object),n(t.Object.prototype,t.Observable),t.Object.NUM_FRACTION_DIGITS=2,t.Object._fromObject=function(e,n,r,s){var o=t[e];n=i(n,!0),t.util.enlivenPatterns([n.fill,n.stroke],function(e){"undefined"!=typeof e[0]&&(n.fill=e[0]),"undefined"!=typeof e[1]&&(n.stroke=e[1]);var t=s?new o(n[s],n):new o(n);r&&r(t)})},t.Object.__uid=0)}("undefined"!=typeof exports?exports:this);!function(){var e=fabric.util.degreesToRadians,t={left:-.5,center:0,right:.5},i={top:-.5,center:0,bottom:.5};fabric.util.object.extend(fabric.Object.prototype,{translateToGivenOrigin:function(e,n,r,s,o){var a,c,l,u=e.x,h=e.y;return"string"==typeof n?n=t[n]:n-=.5,"string"==typeof s?s=t[s]:s-=.5,a=s-n,"string"==typeof r?r=i[r]:r-=.5,"string"==typeof o?o=i[o]:o-=.5,c=o-r,(a||c)&&(l=this._getTransformedDimensions(),u=e.x+a*l.x,h=e.y+c*l.y),new fabric.Point(u,h)},translateToCenterPoint:function(t,i,n){var r=this.translateToGivenOrigin(t,i,n,"center","center");return this.angle?fabric.util.rotatePoint(r,t,e(this.angle)):r},translateToOriginPoint:function(t,i,n){var r=this.translateToGivenOrigin(t,"center","center",i,n);return this.angle?fabric.util.rotatePoint(r,t,e(this.angle)):r},getCenterPoint:function(){var e=new fabric.Point(this.left,this.top);return this.translateToCenterPoint(e,this.originX,this.originY)},getPointByOrigin:function(e,t){var i=this.getCenterPoint();return this.translateToOriginPoint(i,e,t)},toLocalPoint:function(t,i,n){var r,s,o=this.getCenterPoint();return r="undefined"!=typeof i&&"undefined"!=typeof n?this.translateToGivenOrigin(o,"center","center",i,n):new fabric.Point(this.left,this.top),s=new fabric.Point(t.x,t.y),this.angle&&(s=fabric.util.rotatePoint(s,o,-e(this.angle))),s.subtractEquals(r)},setPositionByOrigin:function(e,t,i){var n=this.translateToCenterPoint(e,t,i),r=this.translateToOriginPoint(n,this.originX,this.originY);this.set("left",r.x),this.set("top",r.y)},adjustPosition:function(i){var n,r,s=e(this.angle),o=this.getScaledWidth(),a=fabric.util.cos(s)*o,c=fabric.util.sin(s)*o;n="string"==typeof this.originX?t[this.originX]:this.originX-.5,r="string"==typeof i?t[i]:i-.5,this.left+=a*(r-n),this.top+=c*(r-n),this.setCoords(),this.originX=i},_setOriginToCenter:function(){this._originalOriginX=this.originX,this._originalOriginY=this.originY;var e=this.getCenterPoint();this.originX="center",this.originY="center",this.left=e.x,this.top=e.y},_resetOrigin:function(){var e=this.translateToOriginPoint(this.getCenterPoint(),this._originalOriginX,this._originalOriginY);this.originX=this._originalOriginX,this.originY=this._originalOriginY,this.left=e.x,this.top=e.y,this._originalOriginX=null,this._originalOriginY=null},_getLeftTopCoords:function(){return this.translateToOriginPoint(this.getCenterPoint(),"left","top")}})}();!function(){function e(e){return[new fabric.Point(e.tl.x,e.tl.y),new fabric.Point(e.tr.x,e.tr.y),new fabric.Point(e.br.x,e.br.y),new fabric.Point(e.bl.x,e.bl.y)]}var t=fabric.util.degreesToRadians,i=fabric.util.multiplyTransformMatrices,n=fabric.util.transformPoint;fabric.util.object.extend(fabric.Object.prototype,{oCoords:null,aCoords:null,ownMatrixCache:null,matrixCache:null,getCoords:function(t,i){this.oCoords||this.setCoords();var n=t?this.aCoords:this.oCoords;return e(i?this.calcCoords(t):n)},intersectsWithRect:function(e,t,i,n){var r=this.getCoords(i,n),s=fabric.Intersection.intersectPolygonRectangle(r,e,t);return"Intersection"===s.status},intersectsWithObject:function(e,t,i){var n=fabric.Intersection.intersectPolygonPolygon(this.getCoords(t,i),e.getCoords(t,i));return"Intersection"===n.status||e.isContainedWithinObject(this,t,i)||this.isContainedWithinObject(e,t,i)},isContainedWithinObject:function(e,t,i){for(var n=this.getCoords(t,i),r=0,s=e._getImageLines(i?e.calcCoords(t):t?e.aCoords:e.oCoords);4>r;r++)if(!e.containsPoint(n[r],s))return!1;return!0},isContainedWithinRect:function(e,t,i,n){var r=this.getBoundingRect(i,n);return r.left>=e.x&&r.left+r.width<=t.x&&r.top>=e.y&&r.top+r.height<=t.y},containsPoint:function(e,t,i,n){var t=t||this._getImageLines(n?this.calcCoords(i):i?this.aCoords:this.oCoords),r=this._findCrossPoints(e,t);return 0!==r&&r%2===1},isOnScreen:function(e){if(!this.canvas)return!1;for(var t,i=this.canvas.vptCoords.tl,n=this.canvas.vptCoords.br,r=this.getCoords(!0,e),s=0;4>s;s++)if(t=r[s],t.x<=n.x&&t.x>=i.x&&t.y<=n.y&&t.y>=i.y)return!0;return this.intersectsWithRect(i,n,!0,e)?!0:this._containsCenterOfCanvas(i,n,e)},_containsCenterOfCanvas:function(e,t,i){var n={x:(e.x+t.x)/2,y:(e.y+t.y)/2};return this.containsPoint(n,null,!0,i)?!0:!1},isPartiallyOnScreen:function(e){if(!this.canvas)return!1;var t=this.canvas.vptCoords.tl,i=this.canvas.vptCoords.br;return this.intersectsWithRect(t,i,!0,e)?!0:this._containsCenterOfCanvas(t,i,e)},_getImageLines:function(e){return{topline:{o:e.tl,d:e.tr},rightline:{o:e.tr,d:e.br},bottomline:{o:e.br,d:e.bl},leftline:{o:e.bl,d:e.tl}}},_findCrossPoints:function(e,t){var i,n,r,s,o,a,c=0;for(var l in t)if(a=t[l],!(a.o.y<e.y&&a.d.y<e.y||a.o.y>=e.y&&a.d.y>=e.y||(a.o.x===a.d.x&&a.o.x>=e.x?o=a.o.x:(i=0,n=(a.d.y-a.o.y)/(a.d.x-a.o.x),r=e.y-i*e.x,s=a.o.y-n*a.o.x,o=-(r-s)/(i-n)),o>=e.x&&(c+=1),2!==c)))break;return c},getBoundingRect:function(e,t){var i=this.getCoords(e,t);return fabric.util.makeBoundingBoxFromPoints(i)},getScaledWidth:function(){return this._getTransformedDimensions().x},getScaledHeight:function(){return this._getTransformedDimensions().y},_constrainScale:function(e){return Math.abs(e)<this.minScaleLimit?0>e?-this.minScaleLimit:this.minScaleLimit:0===e?1e-4:e},scale:function(e){return this._set("scaleX",e),this._set("scaleY",e),this.setCoords()},scaleToWidth:function(e,t){var i=this.getBoundingRect(t).width/this.getScaledWidth();return this.scale(e/this.width/i)},scaleToHeight:function(e,t){var i=this.getBoundingRect(t).height/this.getScaledHeight();return this.scale(e/this.height/i)},calcCoords:function(e){var r=this._calcRotateMatrix(),s=this._calcTranslateMatrix(),o=i(s,r),a=this.getViewportTransform(),c=e?o:i(a,o),l=this._getTransformedDimensions(),h=l.x/2,u=l.y/2,f=n({x:-h,y:-u},c),d=n({x:h,y:-u},c),v=n({x:-h,y:u},c),g=n({x:h,y:u},c);if(!e){var p=this.padding,m=t(this.angle),b=fabric.util.cos(m),y=fabric.util.sin(m),_=b*p,w=y*p,C=_+w,x=_-w;p&&(f.x-=x,f.y-=C,d.x+=C,d.y-=x,v.x-=C,v.y+=x,g.x+=x,g.y+=C);var j=new fabric.Point((f.x+v.x)/2,(f.y+v.y)/2),O=new fabric.Point((d.x+f.x)/2,(d.y+f.y)/2),S=new fabric.Point((g.x+d.x)/2,(g.y+d.y)/2),E=new fabric.Point((g.x+v.x)/2,(g.y+v.y)/2),T=new fabric.Point(O.x+y*this.rotatingPointOffset,O.y-b*this.rotatingPointOffset)}var P={tl:f,tr:d,br:g,bl:v};return e||(P.ml=j,P.mt=O,P.mr=S,P.mb=E,P.mtr=T),P},setCoords:function(e,t){return this.oCoords=this.calcCoords(e),t||(this.aCoords=this.calcCoords(!0)),e||this._setCornerCoords&&this._setCornerCoords(),this},_calcRotateMatrix:function(){if(this.angle){var e=t(this.angle),i=fabric.util.cos(e),n=fabric.util.sin(e);return[i,n,-n,i,0,0]}return fabric.iMatrix.concat()},_calcTranslateMatrix:function(){var e=this.getCenterPoint();return[1,0,0,1,e.x,e.y]},transformMatrixKey:function(e){var t="_",i="";return!e&&this.group&&(i=this.group.transformMatrixKey(e)+t),i+this.top+t+this.left+t+this.scaleX+t+this.scaleY+t+this.skewX+t+this.skewY+t+this.angle+t+this.originX+t+this.originY+t+this.width+t+this.height+t+this.strokeWidth+this.flipX+this.flipY},calcTransformMatrix:function(e){if(e)return this.calcOwnMatrix();var t=this.transformMatrixKey(),n=this.matrixCache||(this.matrixCache={});if(n.key===t)return n.value;var r=this.calcOwnMatrix();return this.group&&(r=i(this.group.calcTransformMatrix(),r)),n.key=t,n.value=r,r},calcOwnMatrix:function(){var e=this.transformMatrixKey(!0),t=this.ownMatrixCache||(this.ownMatrixCache={});if(t.key===e)return t.value;var n,r=this._calcTranslateMatrix(),s=this._calcDimensionsTransformMatrix(this.skewX,this.skewY,!0);return this.angle&&(n=this._calcRotateMatrix(),r=i(r,n)),r=i(r,s),t.key=e,t.value=r,r},_calcDimensionsTransformMatrix:function(e,n,r){var s,o=this.scaleX*(r&&this.flipX?-1:1),a=this.scaleY*(r&&this.flipY?-1:1),c=[o,0,0,a,0,0];return e&&(s=[1,0,Math.tan(t(e)),1],c=i(c,s,!0)),n&&(s=[1,Math.tan(t(n)),0,1],c=i(c,s,!0)),c},_getNonTransformedDimensions:function(){var e=this.strokeWidth,t=this.width+e,i=this.height+e;return{x:t,y:i}},_getTransformedDimensions:function(e,t){"undefined"==typeof e&&(e=this.skewX),"undefined"==typeof t&&(t=this.skewY);var i=this._getNonTransformedDimensions();if(0===e&&0===t)return{x:i.x*this.scaleX,y:i.y*this.scaleY};var n,r,s=i.x/2,o=i.y/2,a=[{x:-s,y:-o},{x:s,y:-o},{x:-s,y:o},{x:s,y:o}],c=this._calcDimensionsTransformMatrix(e,t,!1);for(n=0;n<a.length;n++)a[n]=fabric.util.transformPoint(a[n],c);return r=fabric.util.makeBoundingBoxFromPoints(a),{x:r.width,y:r.height}},_calculateCurrentDimensions:function(){var e=this.getViewportTransform(),t=this._getTransformedDimensions(),i=fabric.util.transformPoint(t,e,!0);return i.scalarAdd(2*this.padding)}})}();fabric.util.object.extend(fabric.Object.prototype,{sendToBack:function(){return this.group?fabric.StaticCanvas.prototype.sendToBack.call(this.group,this):this.canvas.sendToBack(this),this},bringToFront:function(){return this.group?fabric.StaticCanvas.prototype.bringToFront.call(this.group,this):this.canvas.bringToFront(this),this},sendBackwards:function(e){return this.group?fabric.StaticCanvas.prototype.sendBackwards.call(this.group,this,e):this.canvas.sendBackwards(this,e),this},bringForward:function(e){return this.group?fabric.StaticCanvas.prototype.bringForward.call(this.group,this,e):this.canvas.bringForward(this,e),this},moveTo:function(e){return this.group&&"activeSelection"!==this.group.type?fabric.StaticCanvas.prototype.moveTo.call(this.group,this,e):this.canvas.moveTo(this,e),this}});!function(){function e(e,t,n){var r={},s=!0;n.forEach(function(t){r[t]=e[t]}),i(e[t],r,s)}function t(e,i,n){if(e===i)return!0;if(Array.isArray(e)){if(!Array.isArray(i)||e.length!==i.length)return!1;for(var r=0,s=e.length;s>r;r++)if(!t(e[r],i[r]))return!1;return!0}if(e&&"object"==typeof e){var o,a=Object.keys(e);if(!i||"object"!=typeof i||!n&&a.length!==Object.keys(i).length)return!1;for(var r=0,s=a.length;s>r;r++)if(o=a[r],!t(e[o],i[o]))return!1;return!0}}var i=fabric.util.object.extend,n="stateProperties";fabric.util.object.extend(fabric.Object.prototype,{hasStateChanged:function(e){e=e||n;var i="_"+e;return Object.keys(this[i]).length<this[e].length?!0:!t(this[i],this,!0)},saveState:function(t){var i=t&&t.propertySet||n,r="_"+i;return this[r]?(e(this,r,this[i]),t&&t.stateProperties&&e(this,r,t.stateProperties),this):this.setupState(t)},setupState:function(e){e=e||{};var t=e.propertySet||n;return e.propertySet=t,this["_"+t]={},this.saveState(e),this}})}();!function(){var t=fabric.util.degreesToRadians;fabric.util.object.extend(fabric.Object.prototype,{_controlsVisibility:null,_findTargetCorner:function(t){if(!this.hasControls||this.group||!this.canvas||this.canvas._activeObject!==this)return!1;var e,i,n=t.x,r=t.y;this.__corner=0;for(var s in this.oCoords)if(this.isControlVisible(s)&&("mtr"!==s||this.hasRotatingPoint)&&(!this.get("lockUniScaling")||"mt"!==s&&"mr"!==s&&"mb"!==s&&"ml"!==s)&&(i=this._getImageLines(this.oCoords[s].corner),e=this._findCrossPoints({x:n,y:r},i),0!==e&&e%2===1))return this.__corner=s,s;return!1},_setCornerCoords:function(){var e,i,n=this.oCoords,r=t(45-this.angle),s=.707106*this.cornerSize,o=s*fabric.util.cos(r),a=s*fabric.util.sin(r);for(var c in n)e=n[c].x,i=n[c].y,n[c].corner={tl:{x:e-a,y:i-o},tr:{x:e+o,y:i-a},bl:{x:e-o,y:i+a},br:{x:e+a,y:i+o}}},drawSelectionBackground:function(e){if(!this.selectionBackgroundColor||this.canvas&&!this.canvas.interactive||this.canvas&&this.canvas._activeObject!==this)return this;e.save();var i=this.getCenterPoint(),n=this._calculateCurrentDimensions(),r=this.canvas.viewportTransform;return e.translate(i.x,i.y),e.scale(1/r[0],1/r[3]),e.rotate(t(this.angle)),e.fillStyle=this.selectionBackgroundColor,e.fillRect(-n.x/2,-n.y/2,n.x,n.y),e.restore(),this},drawBorders:function(t,e){e=e||{};var i=this._calculateCurrentDimensions(),n=1/this.borderScaleFactor,r=i.x+n,s=i.y+n,o="undefined"!=typeof e.hasRotatingPoint?e.hasRotatingPoint:this.hasRotatingPoint,a="undefined"!=typeof e.hasControls?e.hasControls:this.hasControls,c="undefined"!=typeof e.rotatingPointOffset?e.rotatingPointOffset:this.rotatingPointOffset;if(t.save(),t.strokeStyle=e.borderColor||this.borderColor,this._setLineDash(t,e.borderDashArray||this.borderDashArray,null),t.strokeRect(-r/2,-s/2,r,s),o&&this.isControlVisible("mtr")&&a){var h=-s/2;t.beginPath(),t.moveTo(0,h),t.lineTo(0,h-c),t.stroke()}return t.restore(),this},drawBordersInGroup:function(t,e,i){i=i||{};var n=this._getNonTransformedDimensions(),r=fabric.util.customTransformMatrix(e.scaleX,e.scaleY,e.skewX),s=fabric.util.transformPoint(n,r),o=1/this.borderScaleFactor,a=s.x+o,c=s.y+o;return t.save(),this._setLineDash(t,i.borderDashArray||this.borderDashArray,null),t.strokeStyle=i.borderColor||this.borderColor,t.strokeRect(-a/2,-c/2,a,c),t.restore(),this},drawControls:function(t,e){e=e||{};var i=this._calculateCurrentDimensions(),n=i.x,r=i.y,s=e.cornerSize||this.cornerSize,o=-(n+s)/2,a=-(r+s)/2,c="undefined"!=typeof e.transparentCorners?e.transparentCorners:this.transparentCorners,h="undefined"!=typeof e.hasRotatingPoint?e.hasRotatingPoint:this.hasRotatingPoint,l=c?"stroke":"fill";return t.save(),t.strokeStyle=t.fillStyle=e.cornerColor||this.cornerColor,this.transparentCorners||(t.strokeStyle=e.cornerStrokeColor||this.cornerStrokeColor),this._setLineDash(t,e.cornerDashArray||this.cornerDashArray,null),this._drawControl("tl",t,l,o,a,e),this._drawControl("tr",t,l,o+n,a,e),this._drawControl("bl",t,l,o,a+r,e),this._drawControl("br",t,l,o+n,a+r,e),this.get("lockUniScaling")||(this._drawControl("mt",t,l,o+n/2,a,e),this._drawControl("mb",t,l,o+n/2,a+r,e),this._drawControl("mr",t,l,o+n,a+r/2,e),this._drawControl("ml",t,l,o,a+r/2,e)),h&&this._drawControl("mtr",t,l,o+n/2,a-this.rotatingPointOffset,e),t.restore(),this},_drawControl:function(t,e,i,n,r,s){if(s=s||{},this.isControlVisible(t)){var o=this.cornerSize,a=!this.transparentCorners&&this.cornerStrokeColor;switch(s.cornerStyle||this.cornerStyle){case"circle":e.beginPath(),e.arc(n+o/2,r+o/2,o/2,0,2*Math.PI,!1),e[i](),a&&e.stroke();break;default:this.transparentCorners||e.clearRect(n,r,o,o),e[i+"Rect"](n,r,o,o),a&&e.strokeRect(n,r,o,o)}}},isControlVisible:function(t){return this._getControlsVisibility()[t]},setControlVisible:function(t,e){return this._getControlsVisibility()[t]=e,this},setControlsVisibility:function(t){t||(t={});for(var e in t)this.setControlVisible(e,t[e]);return this},_getControlsVisibility:function(){return this._controlsVisibility||(this._controlsVisibility={tl:!0,tr:!0,br:!0,bl:!0,ml:!0,mt:!0,mr:!0,mb:!0,mtr:!0}),this._controlsVisibility},onDeselect:function(){},onSelect:function(){}})}();!function(t){"use strict";var e=t.fabric||(t.fabric={}),i=e.util.object.extend,n=e.util.array.min,r=e.util.array.max;e.Group||(e.Group=e.util.createClass(e.Object,e.Collection,{type:"group",strokeWidth:0,subTargetCheck:!1,cacheProperties:[],useSetOnGroup:!1,initialize:function(t,e,i){e=e||{},this._objects=[],i&&this.callSuper("initialize",e),this._objects=t||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;if(e.originX&&(this.originX=e.originX),e.originY&&(this.originY=e.originY),i)this._updateObjectsACoords();else{var r=e&&e.centerPoint;r||this._calcBounds(),this._updateObjectsCoords(r),delete e.centerPoint,this.callSuper("initialize",e)}this.setCoords()},_updateObjectsACoords:function(){for(var t=!0,e=!0,i=this._objects.length;i--;)this._objects[i].setCoords(t,e)},_updateObjectsCoords:function(t){for(var t=t||this.getCenterPoint(),e=this._objects.length;e--;)this._updateObjectCoords(this._objects[e],t)},_updateObjectCoords:function(t,e){var i=t.left,n=t.top,r=!0,s=!0;t.set({left:i-e.x,top:n-e.y}),t.group=this,t.setCoords(r,s)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},addWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),t&&(this._objects.push(t),t.group=this,t._set("canvas",this.canvas)),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},removeWithUpdate:function(t){return this._restoreObjectsState(),e.util.resetObjectTransform(this),this.remove(t),this._calcBounds(),this._updateObjectsCoords(),this.setCoords(),this.dirty=!0,this},_onObjectAdded:function(t){this.dirty=!0,t.group=this,t._set("canvas",this.canvas)},_onObjectRemoved:function(t){this.dirty=!0,delete t.group},_set:function(t,e){var i=this._objects.length;if(this.useSetOnGroup)for(;i--;)this._objects[i].setOnGroup(t,e);if("canvas"===t)for(i=this._objects.length;i--;)this._objects[i]._set(t,e);this.callSuper("_set",t,e)},toObject:function(t){var e=this.getObjects().map(function(e){var i=e.includeDefaultValues;e.includeDefaultValues=e.group.includeDefaultValues;var n=e.toObject(t);return e.includeDefaultValues=i,n});return i(this.callSuper("toObject",t),{objects:e})},toDatalessObject:function(t){var e,n=this.sourcePath;return e=n?n:this.getObjects().map(function(e){var i=e.includeDefaultValues;e.includeDefaultValues=e.group.includeDefaultValues;var n=e.toDatalessObject(t);return e.includeDefaultValues=i,n}),i(this.callSuper("toDatalessObject",t),{objects:e})},render:function(t){this._transformDone=!0,this.callSuper("render",t),this._transformDone=!1},shouldCache:function(){var t=this.objectCaching&&(!this.group||this.needsItsOwnCache()||!this.group.isOnACache());if(this.ownCaching=t,t)for(var e=0,i=this._objects.length;i>e;e++)if(this._objects[e].willDrawShadow())return this.ownCaching=!1,!1;return t},willDrawShadow:function(){if(this.shadow)return this.callSuper("willDrawShadow");for(var t=0,e=this._objects.length;e>t;t++)if(this._objects[t].willDrawShadow())return!0;return!1},isOnACache:function(){return this.ownCaching||this.group&&this.group.isOnACache()},drawObject:function(t){for(var e=0,i=this._objects.length;i>e;e++)this._objects[e].render(t)},isCacheDirty:function(){if(this.callSuper("isCacheDirty"))return!0;if(!this.statefullCache)return!1;for(var t=0,e=this._objects.length;e>t;t++)if(this._objects[t].isCacheDirty(!0)){if(this._cacheCanvas){var i=this.cacheWidth/this.zoomX,n=this.cacheHeight/this.zoomY;this._cacheContext.clearRect(-i/2,-n/2,i,n)}return!0}return!1},_restoreObjectsState:function(){return this._objects.forEach(this._restoreObjectState,this),this},realizeTransform:function(t){var i=t.calcTransformMatrix(),n=e.util.qrDecompose(i),r=new e.Point(n.translateX,n.translateY);return t.flipX=!1,t.flipY=!1,t.set("scaleX",n.scaleX),t.set("scaleY",n.scaleY),t.skewX=n.skewX,t.skewY=n.skewY,t.angle=n.angle,t.setPositionByOrigin(r,"center","center"),t},_restoreObjectState:function(t){return this.realizeTransform(t),t.setCoords(),delete t.group,this},destroy:function(){return this._objects.forEach(function(t){t.set("dirty",!0)}),this._restoreObjectsState()},toActiveSelection:function(){if(this.canvas){var t=this._objects,i=this.canvas;this._objects=[];var n=this.toObject();delete n.objects;var r=new e.ActiveSelection([]);return r.set(n),r.type="activeSelection",i.remove(this),t.forEach(function(t){t.group=r,t.dirty=!0,i.add(t)}),r.canvas=i,r._objects=t,i._activeObject=r,r.setCoords(),r}},ungroupOnCanvas:function(){return this._restoreObjectsState()},setObjectsCoords:function(){var t=!0,e=!0;return this.forEachObject(function(i){i.setCoords(t,e)}),this},_calcBounds:function(t){for(var e,i,n,r=[],s=[],o=["tr","br","bl","tl"],a=0,c=this._objects.length,h=o.length,l=!0;c>a;++a)for(e=this._objects[a],e.setCoords(l),n=0;h>n;n++)i=o[n],r.push(e.oCoords[i].x),s.push(e.oCoords[i].y);this.set(this._getBounds(r,s,t))},_getBounds:function(t,i,s){var o=new e.Point(n(t),n(i)),a=new e.Point(r(t),r(i)),c={width:a.x-o.x||0,height:a.y-o.y||0};return s||(c.left=o.x||0,c.top=o.y||0,"center"===this.originX&&(c.left+=c.width/2),"right"===this.originX&&(c.left+=c.width),"center"===this.originY&&(c.top+=c.height/2),"bottom"===this.originY&&(c.top+=c.height)),c}}),e.Group.fromObject=function(t,i){e.util.enlivenObjects(t.objects,function(n){var r=e.util.object.clone(t,!0);delete r.objects,i&&i(new e.Group(n,r,!0))})})}("undefined"!=typeof exports?exports:this);!function(t){"use strict";var e=t.fabric||(t.fabric={});e.ActiveSelection||(e.ActiveSelection=e.util.createClass(e.Group,{type:"activeSelection",initialize:function(t,i){i=i||{},this._objects=t||[];for(var n=this._objects.length;n--;)this._objects[n].group=this;i.originX&&(this.originX=i.originX),i.originY&&(this.originY=i.originY),this._calcBounds(),this._updateObjectsCoords(),e.Object.prototype.initialize.call(this,i),this.setCoords()},toGroup:function(){var t=this._objects;this._objects=[];var i=this.toObject(),n=new e.Group([]);if(delete i.objects,n.set(i),n.type="group",t.forEach(function(t){t.group=n,t.canvas.remove(t)}),n._objects=t,!this.canvas)return n;var r=this.canvas;return r.add(n),r._activeObject=n,n.setCoords(),n},onDeselect:function(){return this.destroy(),!1},toString:function(){return"#<fabric.ActiveSelection: ("+this.complexity()+")>"},_set:function(t,i){var n=this._objects.length;if("canvas"===t)for(;n--;)this._objects[n].set(t,i);if(this.useSetOnGroup)for(;n--;)this._objects[n].setOnGroup(t,i);e.Object.prototype._set.call(this,t,i)},shouldCache:function(){return!1},willDrawShadow:function(){if(this.shadow)return this.callSuper("willDrawShadow");for(var t=0,e=this._objects.length;e>t;t++)if(this._objects[t].willDrawShadow())return!0;return!1},isOnACache:function(){return!1},_renderControls:function(t,e,i){t.save(),t.globalAlpha=this.isMoving?this.borderOpacityWhenMoving:1,this.callSuper("_renderControls",t,e),i=i||{},"undefined"==typeof i.hasControls&&(i.hasControls=!1),"undefined"==typeof i.hasRotatingPoint&&(i.hasRotatingPoint=!1),i.forActiveSelection=!0;for(var n=0,r=this._objects.length;r>n;n++)this._objects[n]._renderControls(t,i);t.restore()}}),e.ActiveSelection.fromObject=function(t,i){e.util.enlivenObjects(t.objects,function(n){delete t.objects,i&&i(new e.ActiveSelection(n,t,!0))})})}("undefined"!=typeof exports?exports:this);